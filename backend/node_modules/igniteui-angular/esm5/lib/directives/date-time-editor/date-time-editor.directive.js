import { __decorate, __extends, __param, __values } from "tslib";
import { Directive, Input, ElementRef, Renderer2, NgModule, Output, EventEmitter, Inject, LOCALE_ID, OnChanges, SimpleChanges, Host, Optional, Injector } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR, } from '@angular/forms';
import { formatDate, DOCUMENT } from '@angular/common';
import { IgxMaskDirective } from '../mask/mask.directive';
import { MaskParsingService } from '../mask/mask-parsing.service';
import { DatePickerUtil } from '../../date-picker/date-picker.utils';
import { DatePart } from './date-time-editor.common';
/**
 * Date Time Editor provides a functionality to input, edit and format date and time.
 *
 * @igxModule IgxDateTimeEditorModule
 *
 * @igxParent IgxInputGroup
 *
 * @igxTheme igx-input-theme
 *
 * @igxKeywords date, time, editor
 *
 * @igxGroup Scheduling
 *
 * @remarks
 *
 * The Ignite UI Date Time Editor Directive makes it easy for developers to manipulate date/time user input.
 * It requires input in a specified or default input format which is visible in the input element as a placeholder.
 * It allows the input of only date (ex: 'dd/MM/yyyy'), only time (ex:'HH:mm tt') or both at once, if needed.
 * Supports display format that may differ from the input format.
 * Provides methods to increment and decrement any specific/targeted `DatePart`.
 *
 * @example
 * ```html
 * <igx-input-group>
 *   <input type="text" igxInput [igxDateTimeEditor]="'dd/MM/yyyy'" [displayFormat]="'shortDate'" [(ngModel)]="date"/>
 * </igx-input-group>
 * ```
 */
var IgxDateTimeEditorDirective = /** @class */ (function (_super) {
    __extends(IgxDateTimeEditorDirective, _super);
    function IgxDateTimeEditorDirective(renderer, elementRef, maskParser, _document, _locale) {
        var _this = _super.call(this, elementRef, maskParser, renderer) || this;
        _this.renderer = renderer;
        _this.elementRef = elementRef;
        _this.maskParser = maskParser;
        _this._document = _document;
        _this._locale = _locale;
        /**
         * Specify if the currently spun date segment should loop over.
         * @example
         * ```html
         * <input igxDateTimeEditor [isSpinLoop]="false">
         * ```
         */
        _this.isSpinLoop = true;
        /**
         * Emitted when the editor's value has changed.
         * @example
         * ```html
         * <input igxDateTimeEditor (valueChange)="onValueChanged($event)"/>
         * ```
         */
        _this.valueChange = new EventEmitter();
        /**
         * Emitted when the editor is not within a specified range or when the editor's value is in an invalid state.
         * @example
         * ```html
         * <input igxDateTimeEditor [minValue]="minDate" [maxValue]="maxDate" (validationFailed)="onValidationFailed($event)"/>
         * ```
         */
        _this.validationFailed = new EventEmitter();
        _this.onTouchCallback = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
        };
        _this.onChangeCallback = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
        };
        _this.onValidatorChange = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
        };
        _this.document = _this._document;
        _this.locale = _this.locale || _this._locale;
        return _this;
    }
    IgxDateTimeEditorDirective_1 = IgxDateTimeEditorDirective;
    Object.defineProperty(IgxDateTimeEditorDirective.prototype, "minValue", {
        /**
         * Minimum value required for the editor to remain valid.
         *
         * @remarks
         * If a `string` value is passed, it must be in the defined input format.
         *
         * @example
         * ```html
         * <input igxDateTimeEditor [minValue]="minDate">
         * ```
         */
        get: function () {
            return this._minValue;
        },
        set: function (value) {
            this._minValue = value;
            this.onValidatorChange();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxDateTimeEditorDirective.prototype, "maxValue", {
        /**
         * Maximum value required for the editor to remain valid.
         *
         * @remarks
         * If a `string` value is passed in, it must be in the defined input format.
         *
         * @example
         * ```html
         * <input igxDateTimeEditor [maxValue]="maxDate">
         * ```
         */
        get: function () {
            return this._maxValue;
        },
        set: function (value) {
            this._maxValue = value;
            this.onValidatorChange();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxDateTimeEditorDirective.prototype, "inputFormat", {
        get: function () {
            return this._format;
        },
        /**
         * Expected user input format (and placeholder).
         * @example
         * ```html
         * <input [igxDateTimeEditor]="'dd/MM/yyyy'">
         * ```
         */
        set: function (value) {
            if (value) {
                this._format = value;
            }
            var mask = (this.inputFormat || DatePickerUtil.DEFAULT_INPUT_FORMAT)
                .replace(new RegExp(/(?=[^t])[\w]/, 'g'), '0');
            this.mask = mask.indexOf('tt') !== -1 ? mask.replace(new RegExp('tt', 'g'), 'LL') : mask;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxDateTimeEditorDirective.prototype, "value", {
        get: function () {
            return this._value;
        },
        /**
         * Editor value.
         * @example
         * ```html
         * <input igxDateTimeEditor [value]="date">
         * ```
         */
        set: function (value) {
            this._value = value;
            this.onChangeCallback(value);
            this.updateMask();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxDateTimeEditorDirective.prototype, "emptyMask", {
        get: function () {
            return this.maskParser.applyMask(null, this.maskOptions);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxDateTimeEditorDirective.prototype, "targetDatePart", {
        get: function () {
            var _this = this;
            var _a;
            if (this.document.activeElement === this.nativeElement) {
                return (_a = this._inputDateParts
                    .find(function (p) { return p.start <= _this.selectionStart && _this.selectionStart <= p.end && p.type !== DatePart.Literal; })) === null || _a === void 0 ? void 0 : _a.type;
            }
            else {
                if (this._inputDateParts.some(function (p) { return p.type === DatePart.Date; })) {
                    return DatePart.Date;
                }
                else if (this._inputDateParts.some(function (p) { return p.type === DatePart.Hours; })) {
                    return DatePart.Hours;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxDateTimeEditorDirective.prototype, "hasDateParts", {
        get: function () {
            return this._inputDateParts.some(function (p) { return p.type === DatePart.Date
                || p.type === DatePart.Month
                || p.type === DatePart.Year; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxDateTimeEditorDirective.prototype, "hasTimeParts", {
        get: function () {
            return this._inputDateParts.some(function (p) { return p.type === DatePart.Hours
                || p.type === DatePart.Minutes
                || p.type === DatePart.Seconds; });
        },
        enumerable: true,
        configurable: true
    });
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.ngOnChanges = function (changes) {
        if (changes['inputFormat'] || changes['locale']) {
            var defPlaceholder = this.inputFormat || DatePickerUtil.getDefaultInputFormat(this.locale);
            this._inputDateParts = DatePickerUtil.parseDateTimeFormat(this.inputFormat);
            this.inputFormat = this._inputDateParts.map(function (p) { return p.format; }).join('');
            if (!this.nativeElement.placeholder) {
                this.renderer.setAttribute(this.nativeElement, 'placeholder', defPlaceholder);
            }
            // TODO: fill in partial dates?
            this.updateMask();
        }
    };
    /** Clear the input element value. */
    IgxDateTimeEditorDirective.prototype.clear = function () {
        this.updateValue(null);
    };
    /**
     * Increment specified DatePart.
     * @param datePart The optional DatePart to increment. Defaults to Date or Hours(when Date is absent from the inputFormat - ex:'HH:mm').
     */
    IgxDateTimeEditorDirective.prototype.increment = function (datePart) {
        var targetDatePart = this.targetDatePart;
        if (!targetDatePart) {
            return;
        }
        var newValue = datePart
            ? this.spinValue(datePart, 1)
            : this.spinValue(targetDatePart, 1);
        this.updateValue(newValue ? newValue : new Date());
    };
    /**
     * Decrement specified DatePart.
     *
     * @param datePart The optional DatePart to decrement. Defaults to Date or Hours(when Date is absent from the inputFormat - ex:'HH:mm').
     */
    IgxDateTimeEditorDirective.prototype.decrement = function (datePart) {
        var targetDatePart = this.targetDatePart;
        if (!targetDatePart) {
            return;
        }
        var newValue = datePart
            ? this.spinValue(datePart, -1)
            : this.spinValue(targetDatePart, -1);
        this.updateValue(newValue ? newValue : new Date());
    };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.writeValue = function (value) {
        this._value = value;
        this.updateMask();
    };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.validate = function (control) {
        if (!this.inputIsComplete() || !control.value) {
            return { 'value': true };
        }
        var maxValueAsDate = this.isDate(this.maxValue) ? this.maxValue : this.parseDate(this.maxValue);
        var minValueAsDate = this.isDate(this.minValue) ? this.minValue : this.parseDate(this.minValue);
        if (minValueAsDate
            && DatePickerUtil.lessThanMinValue(control.value, minValueAsDate, this.hasTimeParts, this.hasDateParts)) {
            return { 'minValue': true };
        }
        if (maxValueAsDate
            && DatePickerUtil.greaterThanMaxValue(control.value, maxValueAsDate, this.hasTimeParts, this.hasDateParts)) {
            return { 'maxValue': true };
        }
        return null;
    };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.registerOnValidatorChange = function (fn) { this.onValidatorChange = fn; };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.registerOnChange = function (fn) { this.onChangeCallback = fn; };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.registerOnTouched = function (fn) { this.onTouchCallback = fn; };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.setDisabledState = function (isDisabled) { };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.onInputChanged = function () {
        var _a;
        _super.prototype.onInputChanged.call(this);
        if (this.inputIsComplete()) {
            var parsedDate = this.parseDate(this.inputValue);
            if (this.isValidDate(parsedDate)) {
                this.updateValue(parsedDate);
            }
            else {
                var oldValue = this.value && new Date(this.value.getTime());
                var args = { oldValue: oldValue, newValue: parsedDate, userInput: this.inputValue };
                this.validationFailed.emit(args);
                if (((_a = args.newValue) === null || _a === void 0 ? void 0 : _a.getTime) && args.newValue.getTime() !== oldValue.getTime()) {
                    this.updateValue(args.newValue);
                }
                else {
                    this.updateValue(null);
                }
            }
        }
        else {
            this.updateValue(null);
        }
    };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.onKeyDown = function (event) {
        _super.prototype.onKeyDown.call(this, event);
        if (event.altKey) {
            return;
        }
        if (event.key === "ArrowUp" /* UP_ARROW */ || event.key === "Up" /* UP_ARROW_IE */ ||
            event.key === "ArrowDown" /* DOWN_ARROW */ || event.key === "Down" /* DOWN_ARROW_IE */) {
            this.spin(event);
            return;
        }
        if (event.ctrlKey && event.key === ";" /* SEMICOLON */) {
            this.updateValue(new Date());
        }
        this.moveCursor(event);
    };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.onFocus = function () {
        this._isFocused = true;
        this.onTouchCallback();
        this.updateMask();
        _super.prototype.onFocus.call(this);
    };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.onBlur = function (value) {
        this._isFocused = false;
        if (!this.inputIsComplete() && this.inputValue !== this.emptyMask) {
            this.updateValue(this.parseDate(this.inputValue));
        }
        else {
            this.updateMask();
        }
        _super.prototype.onBlur.call(this, value);
    };
    /** @hidden @internal */
    IgxDateTimeEditorDirective.prototype.updateMask = function () {
        if (this._isFocused) {
            if (!this.value) {
                return;
            }
            // store the cursor position as it will be moved during masking
            var cursor = this.selectionEnd;
            this.inputValue = this.getMaskedValue();
            this.setSelectionRange(cursor);
        }
        else {
            if (!this.value || !this.isValidDate(this.value)) {
                this.inputValue = '';
                return;
            }
            var format = this.displayFormat || this.inputFormat;
            if (format) {
                this.inputValue = formatDate(this.value, format.replace('tt', 'aa'), this.locale);
            }
            else {
                // TODO: formatter function?
                this.inputValue = this.value.toLocaleString();
            }
        }
    };
    IgxDateTimeEditorDirective.prototype.getMaskedValue = function () {
        var e_1, _a;
        var mask = this.emptyMask;
        try {
            for (var _b = __values(this._inputDateParts), _c = _b.next(); !_c.done; _c = _b.next()) {
                var part = _c.value;
                if (part.type === DatePart.Literal) {
                    continue;
                }
                var targetValue = this.getPartValue(part, part.format.length);
                mask = this.maskParser.replaceInMask(mask, targetValue, this.maskOptions, part.start, part.end).value;
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return mask;
    };
    // TODO: move isDate to utils
    IgxDateTimeEditorDirective.prototype.isDate = function (value) {
        return value instanceof Date && typeof value === 'object';
    };
    IgxDateTimeEditorDirective.prototype.valueInRange = function (value) {
        if (!value) {
            return false;
        }
        var maxValueAsDate = this.isDate(this.maxValue) ? this.maxValue : this.parseDate(this.maxValue);
        var minValueAsDate = this.isDate(this.minValue) ? this.minValue : this.parseDate(this.minValue);
        if (minValueAsDate
            && DatePickerUtil.lessThanMinValue(value, minValueAsDate, this.hasTimeParts, this.hasDateParts)) {
            return false;
        }
        if (maxValueAsDate
            && DatePickerUtil.greaterThanMaxValue(value, maxValueAsDate, this.hasTimeParts, this.hasDateParts)) {
            return false;
        }
        return true;
    };
    IgxDateTimeEditorDirective.prototype.spinValue = function (datePart, delta) {
        if (!this.value || !this.isValidDate(this.value)) {
            return null;
        }
        var newDate = new Date(this.value.getTime());
        switch (datePart) {
            case DatePart.Date:
                DatePickerUtil.spinDate(delta, newDate, this.isSpinLoop);
                break;
            case DatePart.Month:
                DatePickerUtil.spinMonth(delta, newDate, this.isSpinLoop);
                break;
            case DatePart.Year:
                DatePickerUtil.spinYear(delta, newDate);
                break;
            case DatePart.Hours:
                DatePickerUtil.spinHours(delta, newDate, this.isSpinLoop);
                break;
            case DatePart.Minutes:
                DatePickerUtil.spinMinutes(delta, newDate, this.isSpinLoop);
                break;
            case DatePart.Seconds:
                DatePickerUtil.spinSeconds(delta, newDate, this.isSpinLoop);
                break;
            case DatePart.AmPm:
                var formatPart = this._inputDateParts.find(function (dp) { return dp.type === DatePart.AmPm; });
                var amPmFromMask = this.inputValue.substring(formatPart.start, formatPart.end);
                return DatePickerUtil.spinAmPm(newDate, this.value, amPmFromMask);
        }
        return newDate;
    };
    IgxDateTimeEditorDirective.prototype.updateValue = function (newDate) {
        this._oldValue = this.value;
        this.value = newDate;
        if (this.value && !this.valueInRange(this.value)) {
            this.validationFailed.emit({ oldValue: this._oldValue, newValue: this.value, userInput: this.inputValue });
        }
        if (this.inputIsComplete() || this.inputValue === this.emptyMask) {
            this.valueChange.emit(this.value);
        }
    };
    IgxDateTimeEditorDirective.prototype.toTwelveHourFormat = function (value) {
        var hour = parseInt(value.replace(new RegExp(this.promptChar, 'g'), '0'), 10);
        if (hour > 12) {
            hour -= 12;
        }
        else if (hour === 0) {
            hour = 12;
        }
        return hour;
    };
    IgxDateTimeEditorDirective.prototype.getPartValue = function (datePartInfo, partLength) {
        var maskedValue;
        var datePart = datePartInfo.type;
        switch (datePart) {
            case DatePart.Date:
                maskedValue = this.value.getDate();
                break;
            case DatePart.Month:
                // months are zero based
                maskedValue = this.value.getMonth() + 1;
                break;
            case DatePart.Year:
                if (partLength === 2) {
                    maskedValue = this.prependValue(parseInt(this.value.getFullYear().toString().slice(-2), 10), partLength, '0');
                }
                else {
                    maskedValue = this.value.getFullYear();
                }
                break;
            case DatePart.Hours:
                if (datePartInfo.format.indexOf('h') !== -1) {
                    maskedValue = this.prependValue(this.toTwelveHourFormat(this.value.getHours().toString()), partLength, '0');
                }
                else {
                    maskedValue = this.value.getHours();
                }
                break;
            case DatePart.Minutes:
                maskedValue = this.value.getMinutes();
                break;
            case DatePart.Seconds:
                maskedValue = this.value.getSeconds();
                break;
            case DatePart.AmPm:
                maskedValue = this.value.getHours() >= 12 ? 'PM' : 'AM';
                break;
        }
        if (datePartInfo.type !== DatePart.AmPm) {
            return this.prependValue(maskedValue, partLength, '0');
        }
        return maskedValue;
    };
    IgxDateTimeEditorDirective.prototype.prependValue = function (value, partLength, prependChar) {
        return (prependChar + value.toString()).slice(-partLength);
    };
    IgxDateTimeEditorDirective.prototype.spin = function (event) {
        event.preventDefault();
        switch (event.key) {
            case "ArrowUp" /* UP_ARROW */:
            case "Up" /* UP_ARROW_IE */:
                this.increment();
                break;
            case "ArrowDown" /* DOWN_ARROW */:
            case "Down" /* DOWN_ARROW_IE */:
                this.decrement();
                break;
        }
    };
    IgxDateTimeEditorDirective.prototype.inputIsComplete = function () {
        return this.inputValue.indexOf(this.promptChar) === -1;
    };
    IgxDateTimeEditorDirective.prototype.isValidDate = function (date) {
        return date && date.getTime && !isNaN(date.getTime());
    };
    // TODO: move parseDate to utils
    IgxDateTimeEditorDirective.prototype.parseDate = function (val) {
        if (!val) {
            return null;
        }
        return DatePickerUtil.parseValueFromMask(val, this._inputDateParts, this.promptChar);
    };
    IgxDateTimeEditorDirective.prototype.moveCursor = function (event) {
        var value = event.target.value;
        switch (event.key) {
            case "ArrowLeft" /* LEFT_ARROW */:
            case "Left" /* LEFT_ARROW_IE */:
                if (event.ctrlKey) {
                    event.preventDefault();
                    this.setSelectionRange(this.getNewPosition(value));
                }
                break;
            case "ArrowRight" /* RIGHT_ARROW */:
            case "Right" /* RIGHT_ARROW_IE */:
                if (event.ctrlKey) {
                    event.preventDefault();
                    this.setSelectionRange(this.getNewPosition(value, 1));
                }
                break;
        }
    };
    /**
     * Move the cursor in a specific direction until it reaches a date/time separator.
     * Then return its index.
     *
     * @param value The string it operates on.
     * @param direction 0 is left, 1 is right. Default is 0.
     */
    IgxDateTimeEditorDirective.prototype.getNewPosition = function (value, direction) {
        if (direction === void 0) { direction = 0; }
        var literals = this._inputDateParts.filter(function (p) { return p.type === DatePart.Literal; });
        var cursorPos = this.selectionStart;
        if (!direction) {
            do {
                cursorPos = cursorPos > 0 ? --cursorPos : cursorPos;
            } while (!literals.some(function (l) { return l.end === cursorPos; }) && cursorPos > 0);
            return cursorPos;
        }
        else {
            do {
                cursorPos++;
            } while (!literals.some(function (l) { return l.start === cursorPos; }) && cursorPos < value.length);
            return cursorPos;
        }
    };
    var IgxDateTimeEditorDirective_1;
    IgxDateTimeEditorDirective.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef },
        { type: MaskParsingService },
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    __decorate([
        Input()
    ], IgxDateTimeEditorDirective.prototype, "locale", void 0);
    __decorate([
        Input()
    ], IgxDateTimeEditorDirective.prototype, "minValue", null);
    __decorate([
        Input()
    ], IgxDateTimeEditorDirective.prototype, "maxValue", null);
    __decorate([
        Input()
    ], IgxDateTimeEditorDirective.prototype, "isSpinLoop", void 0);
    __decorate([
        Input()
    ], IgxDateTimeEditorDirective.prototype, "displayFormat", void 0);
    __decorate([
        Input("igxDateTimeEditor")
    ], IgxDateTimeEditorDirective.prototype, "inputFormat", null);
    __decorate([
        Input()
    ], IgxDateTimeEditorDirective.prototype, "value", null);
    __decorate([
        Output()
    ], IgxDateTimeEditorDirective.prototype, "valueChange", void 0);
    __decorate([
        Output()
    ], IgxDateTimeEditorDirective.prototype, "validationFailed", void 0);
    IgxDateTimeEditorDirective = IgxDateTimeEditorDirective_1 = __decorate([
        Directive({
            selector: '[igxDateTimeEditor]',
            exportAs: 'igxDateTimeEditor',
            providers: [
                { provide: NG_VALUE_ACCESSOR, useExisting: IgxDateTimeEditorDirective_1, multi: true },
                { provide: NG_VALIDATORS, useExisting: IgxDateTimeEditorDirective_1, multi: true }
            ]
        }),
        __param(3, Inject(DOCUMENT)),
        __param(4, Inject(LOCALE_ID))
    ], IgxDateTimeEditorDirective);
    return IgxDateTimeEditorDirective;
}(IgxMaskDirective));
export { IgxDateTimeEditorDirective };
var IgxDateTimeEditorModule = /** @class */ (function () {
    function IgxDateTimeEditorModule() {
    }
    IgxDateTimeEditorModule = __decorate([
        NgModule({
            declarations: [IgxDateTimeEditorDirective],
            exports: [IgxDateTimeEditorDirective]
        })
    ], IgxDateTimeEditorModule);
    return IgxDateTimeEditorModule;
}());
export { IgxDateTimeEditorModule };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS10aW1lLWVkaXRvci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pZ25pdGV1aS1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvZGF0ZS10aW1lLWVkaXRvci9kYXRlLXRpbWUtZWRpdG9yLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUM1QixTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUNqSCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBRXlDLGFBQWEsRUFBYSxpQkFBaUIsR0FDMUYsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QixPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzFELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRWxFLE9BQU8sRUFDTCxjQUFjLEVBQ2YsTUFBTSxxQ0FBcUMsQ0FBQztBQUM3QyxPQUFPLEVBQTRDLFFBQVEsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRS9GOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0EyQkc7QUFTSDtJQUFnRCw4Q0FBZ0I7SUFvTDlELG9DQUNZLFFBQW1CLEVBQ25CLFVBQXNCLEVBQ3RCLFVBQThCLEVBQ2QsU0FBYyxFQUNiLE9BQVk7UUFMekMsWUFNRSxrQkFBTSxVQUFVLEVBQUUsVUFBVSxFQUFFLFFBQVEsQ0FBQyxTQUd4QztRQVJXLGNBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsZ0JBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsZ0JBQVUsR0FBVixVQUFVLENBQW9C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QUFPLEVBQUUsaUJBQWlCLEVBQUUsV0FBVyxFQUFFLDRCQUEwQixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7Z0JBQ3BGLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUUsNEJBQTBCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTthQUNqRjtTQUNGLENBQUM7UUF5TEcsV0FBQSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDaEIsV0FBQSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUE7T0F6TFQsMEJBQTBCLENBc2pCdEM7SUFBRCxpQ0FBQztDQUFBLEFBdGpCRCxDQUFnRCxnQkFBZ0IsR0FzakIvRDtTQXRqQlksMEJBQTBCO0FBNGpCdkM7SUFBQTtJQUF1QyxDQUFDO0lBQTNCLHVCQUF1QjtRQUpuQyxRQUFRLENBQUM7WUFDUixZQUFZLEVBQUUsQ0FBQywwQkFBMEIsQ0FBQztZQUMxQyxPQUFPLEVBQUUsQ0FBQywwQkFBMEIsQ0FBQztTQUN0QyxDQUFDO09BQ1csdUJBQXVCLENBQUk7SUFBRCw4QkFBQztDQUFBLEFBQXhDLElBQXdDO1NBQTNCLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIERpcmVjdGl2ZSwgSW5wdXQsIEVsZW1lbnRSZWYsXG4gIFJlbmRlcmVyMiwgTmdNb2R1bGUsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbmplY3QsIExPQ0FMRV9JRCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBIb3N0LCBPcHRpb25hbCwgSW5qZWN0b3Jcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBDb250cm9sVmFsdWVBY2Nlc3NvcixcbiAgVmFsaWRhdG9yLCBBYnN0cmFjdENvbnRyb2wsIFZhbGlkYXRpb25FcnJvcnMsIE5HX1ZBTElEQVRPUlMsIE5nQ29udHJvbCwgTkdfVkFMVUVfQUNDRVNTT1IsXG59IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IGZvcm1hdERhdGUsIERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IElneE1hc2tEaXJlY3RpdmUgfSBmcm9tICcuLi9tYXNrL21hc2suZGlyZWN0aXZlJztcbmltcG9ydCB7IE1hc2tQYXJzaW5nU2VydmljZSB9IGZyb20gJy4uL21hc2svbWFzay1wYXJzaW5nLnNlcnZpY2UnO1xuaW1wb3J0IHsgS0VZUyB9IGZyb20gJy4uLy4uL2NvcmUvdXRpbHMnO1xuaW1wb3J0IHtcbiAgRGF0ZVBpY2tlclV0aWxcbn0gZnJvbSAnLi4vLi4vZGF0ZS1waWNrZXIvZGF0ZS1waWNrZXIudXRpbHMnO1xuaW1wb3J0IHsgSWd4RGF0ZVRpbWVFZGl0b3JFdmVudEFyZ3MsIERhdGVQYXJ0SW5mbywgRGF0ZVBhcnQgfSBmcm9tICcuL2RhdGUtdGltZS1lZGl0b3IuY29tbW9uJztcblxuLyoqXG4gKiBEYXRlIFRpbWUgRWRpdG9yIHByb3ZpZGVzIGEgZnVuY3Rpb25hbGl0eSB0byBpbnB1dCwgZWRpdCBhbmQgZm9ybWF0IGRhdGUgYW5kIHRpbWUuXG4gKlxuICogQGlneE1vZHVsZSBJZ3hEYXRlVGltZUVkaXRvck1vZHVsZVxuICpcbiAqIEBpZ3hQYXJlbnQgSWd4SW5wdXRHcm91cFxuICpcbiAqIEBpZ3hUaGVtZSBpZ3gtaW5wdXQtdGhlbWVcbiAqXG4gKiBAaWd4S2V5d29yZHMgZGF0ZSwgdGltZSwgZWRpdG9yXG4gKlxuICogQGlneEdyb3VwIFNjaGVkdWxpbmdcbiAqXG4gKiBAcmVtYXJrc1xuICpcbiAqIFRoZSBJZ25pdGUgVUkgRGF0ZSBUaW1lIEVkaXRvciBEaXJlY3RpdmUgbWFrZXMgaXQgZWFzeSBmb3IgZGV2ZWxvcGVycyB0byBtYW5pcHVsYXRlIGRhdGUvdGltZSB1c2VyIGlucHV0LlxuICogSXQgcmVxdWlyZXMgaW5wdXQgaW4gYSBzcGVjaWZpZWQgb3IgZGVmYXVsdCBpbnB1dCBmb3JtYXQgd2hpY2ggaXMgdmlzaWJsZSBpbiB0aGUgaW5wdXQgZWxlbWVudCBhcyBhIHBsYWNlaG9sZGVyLlxuICogSXQgYWxsb3dzIHRoZSBpbnB1dCBvZiBvbmx5IGRhdGUgKGV4OiAnZGQvTU0veXl5eScpLCBvbmx5IHRpbWUgKGV4OidISDptbSB0dCcpIG9yIGJvdGggYXQgb25jZSwgaWYgbmVlZGVkLlxuICogU3VwcG9ydHMgZGlzcGxheSBmb3JtYXQgdGhhdCBtYXkgZGlmZmVyIGZyb20gdGhlIGlucHV0IGZvcm1hdC5cbiAqIFByb3ZpZGVzIG1ldGhvZHMgdG8gaW5jcmVtZW50IGFuZCBkZWNyZW1lbnQgYW55IHNwZWNpZmljL3RhcmdldGVkIGBEYXRlUGFydGAuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWxcbiAqIDxpZ3gtaW5wdXQtZ3JvdXA+XG4gKiAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGlneElucHV0IFtpZ3hEYXRlVGltZUVkaXRvcl09XCInZGQvTU0veXl5eSdcIiBbZGlzcGxheUZvcm1hdF09XCInc2hvcnREYXRlJ1wiIFsobmdNb2RlbCldPVwiZGF0ZVwiLz5cbiAqIDwvaWd4LWlucHV0LWdyb3VwPlxuICogYGBgXG4gKi9cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tpZ3hEYXRlVGltZUVkaXRvcl0nLFxuICBleHBvcnRBczogJ2lneERhdGVUaW1lRWRpdG9yJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAgeyBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUiwgdXNlRXhpc3Rpbmc6IElneERhdGVUaW1lRWRpdG9yRGlyZWN0aXZlLCBtdWx0aTogdHJ1ZSB9LFxuICAgIHsgcHJvdmlkZTogTkdfVkFMSURBVE9SUywgdXNlRXhpc3Rpbmc6IElneERhdGVUaW1lRWRpdG9yRGlyZWN0aXZlLCBtdWx0aTogdHJ1ZSB9XG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgSWd4RGF0ZVRpbWVFZGl0b3JEaXJlY3RpdmUgZXh0ZW5kcyBJZ3hNYXNrRGlyZWN0aXZlIGltcGxlbWVudHMgT25DaGFuZ2VzLCBWYWxpZGF0b3IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgLyoqXG4gICAqIExvY2FsZSBzZXR0aW5ncyB1c2VkIGZvciB2YWx1ZSBmb3JtYXR0aW5nLlxuICAgKlxuICAgKiBAcmVtYXJrc1xuICAgKiBVc2VzIEFuZ3VsYXIncyBgTE9DQUxFX0lEYCBieSBkZWZhdWx0LiBBZmZlY3RzIGJvdGggaW5wdXQgbWFzayBhbmQgZGlzcGxheSBmb3JtYXQgaWYgdGhvc2UgYXJlIG5vdCBzZXQuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGh0bWxcbiAgICogPGlucHV0IGlneERhdGVUaW1lRWRpdG9yIFtsb2NhbGVdPVwiJ2VuJ1wiPlxuICAgKiBgYGBcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBsb2NhbGU6IHN0cmluZztcblxuICAvKipcbiAgICogTWluaW11bSB2YWx1ZSByZXF1aXJlZCBmb3IgdGhlIGVkaXRvciB0byByZW1haW4gdmFsaWQuXG4gICAqXG4gICAqIEByZW1hcmtzXG4gICAqIElmIGEgYHN0cmluZ2AgdmFsdWUgaXMgcGFzc2VkLCBpdCBtdXN0IGJlIGluIHRoZSBkZWZpbmVkIGlucHV0IGZvcm1hdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgaHRtbFxuICAgKiA8aW5wdXQgaWd4RGF0ZVRpbWVFZGl0b3IgW21pblZhbHVlXT1cIm1pbkRhdGVcIj5cbiAgICogYGBgXG4gICAqL1xuICBwdWJsaWMgZ2V0IG1pblZhbHVlKCk6IHN0cmluZyB8IERhdGUge1xuICAgIHJldHVybiB0aGlzLl9taW5WYWx1ZTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgbWluVmFsdWUodmFsdWU6IHN0cmluZyB8IERhdGUpIHtcbiAgICB0aGlzLl9taW5WYWx1ZSA9IHZhbHVlO1xuICAgIHRoaXMub25WYWxpZGF0b3JDaGFuZ2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXhpbXVtIHZhbHVlIHJlcXVpcmVkIGZvciB0aGUgZWRpdG9yIHRvIHJlbWFpbiB2YWxpZC5cbiAgICpcbiAgICogQHJlbWFya3NcbiAgICogSWYgYSBgc3RyaW5nYCB2YWx1ZSBpcyBwYXNzZWQgaW4sIGl0IG11c3QgYmUgaW4gdGhlIGRlZmluZWQgaW5wdXQgZm9ybWF0LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBodG1sXG4gICAqIDxpbnB1dCBpZ3hEYXRlVGltZUVkaXRvciBbbWF4VmFsdWVdPVwibWF4RGF0ZVwiPlxuICAgKiBgYGBcbiAgICovXG4gIHB1YmxpYyBnZXQgbWF4VmFsdWUoKTogc3RyaW5nIHwgRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuX21heFZhbHVlO1xuICB9XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBtYXhWYWx1ZSh2YWx1ZTogc3RyaW5nIHwgRGF0ZSkge1xuICAgIHRoaXMuX21heFZhbHVlID0gdmFsdWU7XG4gICAgdGhpcy5vblZhbGlkYXRvckNoYW5nZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNwZWNpZnkgaWYgdGhlIGN1cnJlbnRseSBzcHVuIGRhdGUgc2VnbWVudCBzaG91bGQgbG9vcCBvdmVyLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBodG1sXG4gICAqIDxpbnB1dCBpZ3hEYXRlVGltZUVkaXRvciBbaXNTcGluTG9vcF09XCJmYWxzZVwiPlxuICAgKiBgYGBcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBpc1NwaW5Mb29wID0gdHJ1ZTtcblxuICAvKipcbiAgICogU2V0IGJvdGggcHJlLWRlZmluZWQgZm9ybWF0IG9wdGlvbnMgc3VjaCBhcyBgc2hvcnREYXRlYCBhbmQgYGxvbmdEYXRlYCxcbiAgICogYXMgd2VsbCBhcyBjb25zdHJ1Y3RlZCBmb3JtYXQgc3RyaW5nIHVzaW5nIGNoYXJhY3RlcnMgc3VwcG9ydGVkIGJ5IGBEYXRlUGlwZWAsIGUuZy4gYEVFL01NL3l5eXlgLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBodG1sXG4gICAqIDxpbnB1dCBpZ3hEYXRlVGltZUVkaXRvciBbZGlzcGxheUZvcm1hdF09XCInc2hvcnREYXRlJ1wiPlxuICAgKiBgYGBcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBkaXNwbGF5Rm9ybWF0OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEV4cGVjdGVkIHVzZXIgaW5wdXQgZm9ybWF0IChhbmQgcGxhY2Vob2xkZXIpLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBodG1sXG4gICAqIDxpbnB1dCBbaWd4RGF0ZVRpbWVFZGl0b3JdPVwiJ2RkL01NL3l5eXknXCI+XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KGBpZ3hEYXRlVGltZUVkaXRvcmApXG4gIHB1YmxpYyBzZXQgaW5wdXRGb3JtYXQodmFsdWU6IHN0cmluZykge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5fZm9ybWF0ID0gdmFsdWU7XG4gICAgfVxuICAgIGNvbnN0IG1hc2sgPSAodGhpcy5pbnB1dEZvcm1hdCB8fCBEYXRlUGlja2VyVXRpbC5ERUZBVUxUX0lOUFVUX0ZPUk1BVClcbiAgICAgIC5yZXBsYWNlKG5ldyBSZWdFeHAoLyg/PVtedF0pW1xcd10vLCAnZycpLCAnMCcpO1xuICAgIHRoaXMubWFzayA9IG1hc2suaW5kZXhPZigndHQnKSAhPT0gLTEgPyBtYXNrLnJlcGxhY2UobmV3IFJlZ0V4cCgndHQnLCAnZycpLCAnTEwnKSA6IG1hc2s7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGlucHV0Rm9ybWF0KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX2Zvcm1hdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFZGl0b3IgdmFsdWUuXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGh0bWxcbiAgICogPGlucHV0IGlneERhdGVUaW1lRWRpdG9yIFt2YWx1ZV09XCJkYXRlXCI+XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNldCB2YWx1ZSh2YWx1ZTogRGF0ZSkge1xuICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKHZhbHVlKTtcbiAgICB0aGlzLnVwZGF0ZU1hc2soKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgdmFsdWUoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEVtaXR0ZWQgd2hlbiB0aGUgZWRpdG9yJ3MgdmFsdWUgaGFzIGNoYW5nZWQuXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGh0bWxcbiAgICogPGlucHV0IGlneERhdGVUaW1lRWRpdG9yICh2YWx1ZUNoYW5nZSk9XCJvblZhbHVlQ2hhbmdlZCgkZXZlbnQpXCIvPlxuICAgKiBgYGBcbiAgICovXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgdmFsdWVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGU+KCk7XG5cbiAgLyoqXG4gICAqIEVtaXR0ZWQgd2hlbiB0aGUgZWRpdG9yIGlzIG5vdCB3aXRoaW4gYSBzcGVjaWZpZWQgcmFuZ2Ugb3Igd2hlbiB0aGUgZWRpdG9yJ3MgdmFsdWUgaXMgaW4gYW4gaW52YWxpZCBzdGF0ZS5cbiAgICogQGV4YW1wbGVcbiAgICogYGBgaHRtbFxuICAgKiA8aW5wdXQgaWd4RGF0ZVRpbWVFZGl0b3IgW21pblZhbHVlXT1cIm1pbkRhdGVcIiBbbWF4VmFsdWVdPVwibWF4RGF0ZVwiICh2YWxpZGF0aW9uRmFpbGVkKT1cIm9uVmFsaWRhdGlvbkZhaWxlZCgkZXZlbnQpXCIvPlxuICAgKiBgYGBcbiAgICovXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgdmFsaWRhdGlvbkZhaWxlZCA9IG5ldyBFdmVudEVtaXR0ZXI8SWd4RGF0ZVRpbWVFZGl0b3JFdmVudEFyZ3M+KCk7XG5cbiAgcHJpdmF0ZSBfdmFsdWU6IERhdGU7XG4gIHByaXZhdGUgX2Zvcm1hdDogc3RyaW5nO1xuICBwcml2YXRlIGRvY3VtZW50OiBEb2N1bWVudDtcbiAgcHJpdmF0ZSBfaXNGb2N1c2VkOiBib29sZWFuO1xuICBwcml2YXRlIF9taW5WYWx1ZTogc3RyaW5nIHwgRGF0ZTtcbiAgcHJpdmF0ZSBfbWF4VmFsdWU6IHN0cmluZyB8IERhdGU7XG4gIHByaXZhdGUgX29sZFZhbHVlOiBEYXRlIHwgc3RyaW5nO1xuICBwcml2YXRlIF9pbnB1dERhdGVQYXJ0czogRGF0ZVBhcnRJbmZvW107XG4gIHByaXZhdGUgb25Ub3VjaENhbGxiYWNrID0gKC4uLmFyZ3M6IGFueVtdKSA9PiB7IH07XG4gIHByaXZhdGUgb25DaGFuZ2VDYWxsYmFjayA9ICguLi5hcmdzOiBhbnlbXSkgPT4geyB9O1xuICBwcml2YXRlIG9uVmFsaWRhdG9yQ2hhbmdlID0gKC4uLmFyZ3M6IGFueVtdKSA9PiB7IH07XG5cbiAgcHJpdmF0ZSBnZXQgZW1wdHlNYXNrKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubWFza1BhcnNlci5hcHBseU1hc2sobnVsbCwgdGhpcy5tYXNrT3B0aW9ucyk7XG4gIH1cblxuICBwcml2YXRlIGdldCB0YXJnZXREYXRlUGFydCgpOiBEYXRlUGFydCB7XG4gICAgaWYgKHRoaXMuZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gdGhpcy5uYXRpdmVFbGVtZW50KSB7XG4gICAgICByZXR1cm4gdGhpcy5faW5wdXREYXRlUGFydHNcbiAgICAgICAgLmZpbmQocCA9PiBwLnN0YXJ0IDw9IHRoaXMuc2VsZWN0aW9uU3RhcnQgJiYgdGhpcy5zZWxlY3Rpb25TdGFydCA8PSBwLmVuZCAmJiBwLnR5cGUgIT09IERhdGVQYXJ0LkxpdGVyYWwpPy50eXBlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5faW5wdXREYXRlUGFydHMuc29tZShwID0+IHAudHlwZSA9PT0gRGF0ZVBhcnQuRGF0ZSkpIHtcbiAgICAgICAgcmV0dXJuIERhdGVQYXJ0LkRhdGU7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX2lucHV0RGF0ZVBhcnRzLnNvbWUocCA9PiBwLnR5cGUgPT09IERhdGVQYXJ0LkhvdXJzKSkge1xuICAgICAgICByZXR1cm4gRGF0ZVBhcnQuSG91cnM7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaGFzRGF0ZVBhcnRzKCkge1xuICAgIHJldHVybiB0aGlzLl9pbnB1dERhdGVQYXJ0cy5zb21lKFxuICAgICAgcCA9PiBwLnR5cGUgPT09IERhdGVQYXJ0LkRhdGVcbiAgICAgICAgfHwgcC50eXBlID09PSBEYXRlUGFydC5Nb250aFxuICAgICAgICB8fCBwLnR5cGUgPT09IERhdGVQYXJ0LlllYXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaGFzVGltZVBhcnRzKCkge1xuICAgIHJldHVybiB0aGlzLl9pbnB1dERhdGVQYXJ0cy5zb21lKFxuICAgICAgcCA9PiBwLnR5cGUgPT09IERhdGVQYXJ0LkhvdXJzXG4gICAgICAgIHx8IHAudHlwZSA9PT0gRGF0ZVBhcnQuTWludXRlc1xuICAgICAgICB8fCBwLnR5cGUgPT09IERhdGVQYXJ0LlNlY29uZHMpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJvdGVjdGVkIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgcHJvdGVjdGVkIG1hc2tQYXJzZXI6IE1hc2tQYXJzaW5nU2VydmljZSxcbiAgICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIF9kb2N1bWVudDogYW55LFxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIF9sb2NhbGU6IGFueSkge1xuICAgIHN1cGVyKGVsZW1lbnRSZWYsIG1hc2tQYXJzZXIsIHJlbmRlcmVyKTtcbiAgICB0aGlzLmRvY3VtZW50ID0gdGhpcy5fZG9jdW1lbnQgYXMgRG9jdW1lbnQ7XG4gICAgdGhpcy5sb2NhbGUgPSB0aGlzLmxvY2FsZSB8fCB0aGlzLl9sb2NhbGU7XG4gIH1cblxuICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoY2hhbmdlc1snaW5wdXRGb3JtYXQnXSB8fCBjaGFuZ2VzWydsb2NhbGUnXSkge1xuICAgICAgY29uc3QgZGVmUGxhY2Vob2xkZXIgPSB0aGlzLmlucHV0Rm9ybWF0IHx8IERhdGVQaWNrZXJVdGlsLmdldERlZmF1bHRJbnB1dEZvcm1hdCh0aGlzLmxvY2FsZSk7XG4gICAgICB0aGlzLl9pbnB1dERhdGVQYXJ0cyA9IERhdGVQaWNrZXJVdGlsLnBhcnNlRGF0ZVRpbWVGb3JtYXQodGhpcy5pbnB1dEZvcm1hdCk7XG4gICAgICB0aGlzLmlucHV0Rm9ybWF0ID0gdGhpcy5faW5wdXREYXRlUGFydHMubWFwKHAgPT4gcC5mb3JtYXQpLmpvaW4oJycpO1xuICAgICAgaWYgKCF0aGlzLm5hdGl2ZUVsZW1lbnQucGxhY2Vob2xkZXIpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5uYXRpdmVFbGVtZW50LCAncGxhY2Vob2xkZXInLCBkZWZQbGFjZWhvbGRlcik7XG4gICAgICB9XG4gICAgICAvLyBUT0RPOiBmaWxsIGluIHBhcnRpYWwgZGF0ZXM/XG4gICAgICB0aGlzLnVwZGF0ZU1hc2soKTtcbiAgICB9XG4gIH1cblxuICAvKiogQ2xlYXIgdGhlIGlucHV0IGVsZW1lbnQgdmFsdWUuICovXG4gIHB1YmxpYyBjbGVhcigpOiB2b2lkIHtcbiAgICB0aGlzLnVwZGF0ZVZhbHVlKG51bGwpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluY3JlbWVudCBzcGVjaWZpZWQgRGF0ZVBhcnQuXG4gICAqIEBwYXJhbSBkYXRlUGFydCBUaGUgb3B0aW9uYWwgRGF0ZVBhcnQgdG8gaW5jcmVtZW50LiBEZWZhdWx0cyB0byBEYXRlIG9yIEhvdXJzKHdoZW4gRGF0ZSBpcyBhYnNlbnQgZnJvbSB0aGUgaW5wdXRGb3JtYXQgLSBleDonSEg6bW0nKS5cbiAgICovXG4gIHB1YmxpYyBpbmNyZW1lbnQoZGF0ZVBhcnQ/OiBEYXRlUGFydCk6IHZvaWQge1xuICAgIGNvbnN0IHRhcmdldERhdGVQYXJ0ID0gdGhpcy50YXJnZXREYXRlUGFydDtcbiAgICBpZiAoIXRhcmdldERhdGVQYXJ0KSB7IHJldHVybjsgfVxuICAgIGNvbnN0IG5ld1ZhbHVlID0gZGF0ZVBhcnRcbiAgICAgID8gdGhpcy5zcGluVmFsdWUoZGF0ZVBhcnQsIDEpXG4gICAgICA6IHRoaXMuc3BpblZhbHVlKHRhcmdldERhdGVQYXJ0LCAxKTtcbiAgICB0aGlzLnVwZGF0ZVZhbHVlKG5ld1ZhbHVlID8gbmV3VmFsdWUgOiBuZXcgRGF0ZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWNyZW1lbnQgc3BlY2lmaWVkIERhdGVQYXJ0LlxuICAgKlxuICAgKiBAcGFyYW0gZGF0ZVBhcnQgVGhlIG9wdGlvbmFsIERhdGVQYXJ0IHRvIGRlY3JlbWVudC4gRGVmYXVsdHMgdG8gRGF0ZSBvciBIb3Vycyh3aGVuIERhdGUgaXMgYWJzZW50IGZyb20gdGhlIGlucHV0Rm9ybWF0IC0gZXg6J0hIOm1tJykuXG4gICAqL1xuICBwdWJsaWMgZGVjcmVtZW50KGRhdGVQYXJ0PzogRGF0ZVBhcnQpOiB2b2lkIHtcbiAgICBjb25zdCB0YXJnZXREYXRlUGFydCA9IHRoaXMudGFyZ2V0RGF0ZVBhcnQ7XG4gICAgaWYgKCF0YXJnZXREYXRlUGFydCkgeyByZXR1cm47IH1cbiAgICBjb25zdCBuZXdWYWx1ZSA9IGRhdGVQYXJ0XG4gICAgICA/IHRoaXMuc3BpblZhbHVlKGRhdGVQYXJ0LCAtMSlcbiAgICAgIDogdGhpcy5zcGluVmFsdWUodGFyZ2V0RGF0ZVBhcnQsIC0xKTtcbiAgICB0aGlzLnVwZGF0ZVZhbHVlKG5ld1ZhbHVlID8gbmV3VmFsdWUgOiBuZXcgRGF0ZSgpKTtcbiAgfVxuXG4gIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLnVwZGF0ZU1hc2soKTtcbiAgfVxuXG4gIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgdmFsaWRhdGUoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwge1xuICAgIGlmICghdGhpcy5pbnB1dElzQ29tcGxldGUoKSB8fCAhY29udHJvbC52YWx1ZSkge1xuICAgICAgcmV0dXJuIHsgJ3ZhbHVlJzogdHJ1ZSB9O1xuICAgIH1cblxuICAgIGNvbnN0IG1heFZhbHVlQXNEYXRlID0gdGhpcy5pc0RhdGUodGhpcy5tYXhWYWx1ZSkgPyB0aGlzLm1heFZhbHVlIDogdGhpcy5wYXJzZURhdGUodGhpcy5tYXhWYWx1ZSk7XG4gICAgY29uc3QgbWluVmFsdWVBc0RhdGUgPSB0aGlzLmlzRGF0ZSh0aGlzLm1pblZhbHVlKSA/IHRoaXMubWluVmFsdWUgOiB0aGlzLnBhcnNlRGF0ZSh0aGlzLm1pblZhbHVlKTtcbiAgICBpZiAobWluVmFsdWVBc0RhdGVcbiAgICAgICYmIERhdGVQaWNrZXJVdGlsLmxlc3NUaGFuTWluVmFsdWUoXG4gICAgICAgIGNvbnRyb2wudmFsdWUsIG1pblZhbHVlQXNEYXRlLCB0aGlzLmhhc1RpbWVQYXJ0cywgdGhpcy5oYXNEYXRlUGFydHMpKSB7XG4gICAgICByZXR1cm4geyAnbWluVmFsdWUnOiB0cnVlIH07XG4gICAgfVxuICAgIGlmIChtYXhWYWx1ZUFzRGF0ZVxuICAgICAgJiYgRGF0ZVBpY2tlclV0aWwuZ3JlYXRlclRoYW5NYXhWYWx1ZShcbiAgICAgICAgY29udHJvbC52YWx1ZSwgbWF4VmFsdWVBc0RhdGUsIHRoaXMuaGFzVGltZVBhcnRzLCB0aGlzLmhhc0RhdGVQYXJ0cykpIHtcbiAgICAgIHJldHVybiB7ICdtYXhWYWx1ZSc6IHRydWUgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgcmVnaXN0ZXJPblZhbGlkYXRvckNoYW5nZT8oZm46ICgpID0+IHZvaWQpOiB2b2lkIHsgdGhpcy5vblZhbGlkYXRvckNoYW5nZSA9IGZuOyB9XG5cbiAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gIHB1YmxpYyByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHsgdGhpcy5vbkNoYW5nZUNhbGxiYWNrID0gZm47IH1cblxuICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHsgdGhpcy5vblRvdWNoQ2FsbGJhY2sgPSBmbjsgfVxuXG4gIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgc2V0RGlzYWJsZWRTdGF0ZT8oaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQgeyB9XG5cbiAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gIHB1YmxpYyBvbklucHV0Q2hhbmdlZCgpIHtcbiAgICBzdXBlci5vbklucHV0Q2hhbmdlZCgpO1xuICAgIGlmICh0aGlzLmlucHV0SXNDb21wbGV0ZSgpKSB7XG4gICAgICBjb25zdCBwYXJzZWREYXRlID0gdGhpcy5wYXJzZURhdGUodGhpcy5pbnB1dFZhbHVlKTtcbiAgICAgIGlmICh0aGlzLmlzVmFsaWREYXRlKHBhcnNlZERhdGUpKSB7XG4gICAgICAgIHRoaXMudXBkYXRlVmFsdWUocGFyc2VkRGF0ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMudmFsdWUgJiYgbmV3IERhdGUodGhpcy52YWx1ZS5nZXRUaW1lKCkpO1xuICAgICAgICBjb25zdCBhcmdzID0geyBvbGRWYWx1ZTogb2xkVmFsdWUsIG5ld1ZhbHVlOiBwYXJzZWREYXRlLCB1c2VySW5wdXQ6IHRoaXMuaW5wdXRWYWx1ZSB9O1xuICAgICAgICB0aGlzLnZhbGlkYXRpb25GYWlsZWQuZW1pdChhcmdzKTtcbiAgICAgICAgaWYgKGFyZ3MubmV3VmFsdWU/LmdldFRpbWUgJiYgYXJncy5uZXdWYWx1ZS5nZXRUaW1lKCkgIT09IG9sZFZhbHVlLmdldFRpbWUoKSkge1xuICAgICAgICAgIHRoaXMudXBkYXRlVmFsdWUoYXJncy5uZXdWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVWYWx1ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZVZhbHVlKG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgb25LZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgc3VwZXIub25LZXlEb3duKGV2ZW50KTtcbiAgICBpZiAoZXZlbnQuYWx0S2V5KSB7IHJldHVybjsgfVxuICAgIGlmIChldmVudC5rZXkgPT09IEtFWVMuVVBfQVJST1cgfHwgZXZlbnQua2V5ID09PSBLRVlTLlVQX0FSUk9XX0lFIHx8XG4gICAgICBldmVudC5rZXkgPT09IEtFWVMuRE9XTl9BUlJPVyB8fCBldmVudC5rZXkgPT09IEtFWVMuRE9XTl9BUlJPV19JRSkge1xuICAgICAgdGhpcy5zcGluKGV2ZW50KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZXZlbnQuY3RybEtleSAmJiBldmVudC5rZXkgPT09IEtFWVMuU0VNSUNPTE9OKSB7XG4gICAgICB0aGlzLnVwZGF0ZVZhbHVlKG5ldyBEYXRlKCkpO1xuICAgIH1cblxuICAgIHRoaXMubW92ZUN1cnNvcihldmVudCk7XG4gIH1cblxuICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIG9uRm9jdXMoKTogdm9pZCB7XG4gICAgdGhpcy5faXNGb2N1c2VkID0gdHJ1ZTtcbiAgICB0aGlzLm9uVG91Y2hDYWxsYmFjaygpO1xuICAgIHRoaXMudXBkYXRlTWFzaygpO1xuICAgIHN1cGVyLm9uRm9jdXMoKTtcbiAgfVxuXG4gIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgb25CbHVyKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLl9pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICBpZiAoIXRoaXMuaW5wdXRJc0NvbXBsZXRlKCkgJiYgdGhpcy5pbnB1dFZhbHVlICE9PSB0aGlzLmVtcHR5TWFzaykge1xuICAgICAgdGhpcy51cGRhdGVWYWx1ZSh0aGlzLnBhcnNlRGF0ZSh0aGlzLmlucHV0VmFsdWUpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51cGRhdGVNYXNrKCk7XG4gICAgfVxuXG4gICAgc3VwZXIub25CbHVyKHZhbHVlKTtcbiAgfVxuXG4gIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgdXBkYXRlTWFzaygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5faXNGb2N1c2VkKSB7XG4gICAgICBpZiAoIXRoaXMudmFsdWUpIHsgcmV0dXJuOyB9XG4gICAgICAvLyBzdG9yZSB0aGUgY3Vyc29yIHBvc2l0aW9uIGFzIGl0IHdpbGwgYmUgbW92ZWQgZHVyaW5nIG1hc2tpbmdcbiAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuc2VsZWN0aW9uRW5kO1xuICAgICAgdGhpcy5pbnB1dFZhbHVlID0gdGhpcy5nZXRNYXNrZWRWYWx1ZSgpO1xuICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZShjdXJzb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIXRoaXMudmFsdWUgfHwgIXRoaXMuaXNWYWxpZERhdGUodGhpcy52YWx1ZSkpIHtcbiAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gJyc7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZvcm1hdCA9IHRoaXMuZGlzcGxheUZvcm1hdCB8fCB0aGlzLmlucHV0Rm9ybWF0O1xuICAgICAgaWYgKGZvcm1hdCkge1xuICAgICAgICB0aGlzLmlucHV0VmFsdWUgPSBmb3JtYXREYXRlKHRoaXMudmFsdWUsIGZvcm1hdC5yZXBsYWNlKCd0dCcsICdhYScpLCB0aGlzLmxvY2FsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUT0RPOiBmb3JtYXR0ZXIgZnVuY3Rpb24/XG4gICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRoaXMudmFsdWUudG9Mb2NhbGVTdHJpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldE1hc2tlZFZhbHVlKCk6IHN0cmluZyB7XG4gICAgbGV0IG1hc2sgPSB0aGlzLmVtcHR5TWFzaztcbiAgICBmb3IgKGNvbnN0IHBhcnQgb2YgdGhpcy5faW5wdXREYXRlUGFydHMpIHtcbiAgICAgIGlmIChwYXJ0LnR5cGUgPT09IERhdGVQYXJ0LkxpdGVyYWwpIHsgY29udGludWU7IH1cbiAgICAgIGNvbnN0IHRhcmdldFZhbHVlID0gdGhpcy5nZXRQYXJ0VmFsdWUocGFydCwgcGFydC5mb3JtYXQubGVuZ3RoKTtcbiAgICAgIG1hc2sgPSB0aGlzLm1hc2tQYXJzZXIucmVwbGFjZUluTWFzayhtYXNrLCB0YXJnZXRWYWx1ZSwgdGhpcy5tYXNrT3B0aW9ucywgcGFydC5zdGFydCwgcGFydC5lbmQpLnZhbHVlO1xuICAgIH1cblxuICAgIHJldHVybiBtYXNrO1xuICB9XG5cbiAgLy8gVE9ETzogbW92ZSBpc0RhdGUgdG8gdXRpbHNcbiAgcHJpdmF0ZSBpc0RhdGUodmFsdWU6IGFueSk6IHZhbHVlIGlzIERhdGUge1xuICAgIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JztcbiAgfVxuXG4gIHByaXZhdGUgdmFsdWVJblJhbmdlKHZhbHVlOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgaWYgKCF2YWx1ZSkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBjb25zdCBtYXhWYWx1ZUFzRGF0ZSA9IHRoaXMuaXNEYXRlKHRoaXMubWF4VmFsdWUpID8gdGhpcy5tYXhWYWx1ZSA6IHRoaXMucGFyc2VEYXRlKHRoaXMubWF4VmFsdWUpO1xuICAgIGNvbnN0IG1pblZhbHVlQXNEYXRlID0gdGhpcy5pc0RhdGUodGhpcy5taW5WYWx1ZSkgPyB0aGlzLm1pblZhbHVlIDogdGhpcy5wYXJzZURhdGUodGhpcy5taW5WYWx1ZSk7XG4gICAgaWYgKG1pblZhbHVlQXNEYXRlXG4gICAgICAmJiBEYXRlUGlja2VyVXRpbC5sZXNzVGhhbk1pblZhbHVlKFxuICAgICAgICB2YWx1ZSwgbWluVmFsdWVBc0RhdGUsIHRoaXMuaGFzVGltZVBhcnRzLCB0aGlzLmhhc0RhdGVQYXJ0cykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKG1heFZhbHVlQXNEYXRlXG4gICAgICAmJiBEYXRlUGlja2VyVXRpbC5ncmVhdGVyVGhhbk1heFZhbHVlKFxuICAgICAgICB2YWx1ZSwgbWF4VmFsdWVBc0RhdGUsIHRoaXMuaGFzVGltZVBhcnRzLCB0aGlzLmhhc0RhdGVQYXJ0cykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHByaXZhdGUgc3BpblZhbHVlKGRhdGVQYXJ0OiBEYXRlUGFydCwgZGVsdGE6IG51bWJlcik6IERhdGUge1xuICAgIGlmICghdGhpcy52YWx1ZSB8fCAhdGhpcy5pc1ZhbGlkRGF0ZSh0aGlzLnZhbHVlKSkgeyByZXR1cm4gbnVsbDsgfVxuICAgIGNvbnN0IG5ld0RhdGUgPSBuZXcgRGF0ZSh0aGlzLnZhbHVlLmdldFRpbWUoKSk7XG4gICAgc3dpdGNoIChkYXRlUGFydCkge1xuICAgICAgY2FzZSBEYXRlUGFydC5EYXRlOlxuICAgICAgICBEYXRlUGlja2VyVXRpbC5zcGluRGF0ZShkZWx0YSwgbmV3RGF0ZSwgdGhpcy5pc1NwaW5Mb29wKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGVQYXJ0Lk1vbnRoOlxuICAgICAgICBEYXRlUGlja2VyVXRpbC5zcGluTW9udGgoZGVsdGEsIG5ld0RhdGUsIHRoaXMuaXNTcGluTG9vcCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRlUGFydC5ZZWFyOlxuICAgICAgICBEYXRlUGlja2VyVXRpbC5zcGluWWVhcihkZWx0YSwgbmV3RGF0ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRlUGFydC5Ib3VyczpcbiAgICAgICAgRGF0ZVBpY2tlclV0aWwuc3BpbkhvdXJzKGRlbHRhLCBuZXdEYXRlLCB0aGlzLmlzU3Bpbkxvb3ApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0ZVBhcnQuTWludXRlczpcbiAgICAgICAgRGF0ZVBpY2tlclV0aWwuc3Bpbk1pbnV0ZXMoZGVsdGEsIG5ld0RhdGUsIHRoaXMuaXNTcGluTG9vcCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRlUGFydC5TZWNvbmRzOlxuICAgICAgICBEYXRlUGlja2VyVXRpbC5zcGluU2Vjb25kcyhkZWx0YSwgbmV3RGF0ZSwgdGhpcy5pc1NwaW5Mb29wKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGVQYXJ0LkFtUG06XG4gICAgICAgIGNvbnN0IGZvcm1hdFBhcnQgPSB0aGlzLl9pbnB1dERhdGVQYXJ0cy5maW5kKGRwID0+IGRwLnR5cGUgPT09IERhdGVQYXJ0LkFtUG0pO1xuICAgICAgICBjb25zdCBhbVBtRnJvbU1hc2sgPSB0aGlzLmlucHV0VmFsdWUuc3Vic3RyaW5nKGZvcm1hdFBhcnQuc3RhcnQsIGZvcm1hdFBhcnQuZW5kKTtcbiAgICAgICAgcmV0dXJuIERhdGVQaWNrZXJVdGlsLnNwaW5BbVBtKG5ld0RhdGUsIHRoaXMudmFsdWUsIGFtUG1Gcm9tTWFzayk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ld0RhdGU7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVZhbHVlKG5ld0RhdGU6IERhdGUpOiB2b2lkIHtcbiAgICB0aGlzLl9vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdGhpcy52YWx1ZSA9IG5ld0RhdGU7XG5cbiAgICBpZiAodGhpcy52YWx1ZSAmJiAhdGhpcy52YWx1ZUluUmFuZ2UodGhpcy52YWx1ZSkpIHtcbiAgICAgIHRoaXMudmFsaWRhdGlvbkZhaWxlZC5lbWl0KHsgb2xkVmFsdWU6IHRoaXMuX29sZFZhbHVlLCBuZXdWYWx1ZTogdGhpcy52YWx1ZSwgdXNlcklucHV0OiB0aGlzLmlucHV0VmFsdWUgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlucHV0SXNDb21wbGV0ZSgpIHx8IHRoaXMuaW5wdXRWYWx1ZSA9PT0gdGhpcy5lbXB0eU1hc2spIHtcbiAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh0aGlzLnZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHRvVHdlbHZlSG91ckZvcm1hdCh2YWx1ZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBsZXQgaG91ciA9IHBhcnNlSW50KHZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cCh0aGlzLnByb21wdENoYXIsICdnJyksICcwJyksIDEwKTtcbiAgICBpZiAoaG91ciA+IDEyKSB7XG4gICAgICBob3VyIC09IDEyO1xuICAgIH0gZWxzZSBpZiAoaG91ciA9PT0gMCkge1xuICAgICAgaG91ciA9IDEyO1xuICAgIH1cblxuICAgIHJldHVybiBob3VyO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQYXJ0VmFsdWUoZGF0ZVBhcnRJbmZvOiBEYXRlUGFydEluZm8sIHBhcnRMZW5ndGg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgbGV0IG1hc2tlZFZhbHVlO1xuICAgIGNvbnN0IGRhdGVQYXJ0ID0gZGF0ZVBhcnRJbmZvLnR5cGU7XG4gICAgc3dpdGNoIChkYXRlUGFydCkge1xuICAgICAgY2FzZSBEYXRlUGFydC5EYXRlOlxuICAgICAgICBtYXNrZWRWYWx1ZSA9IHRoaXMudmFsdWUuZ2V0RGF0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0ZVBhcnQuTW9udGg6XG4gICAgICAgIC8vIG1vbnRocyBhcmUgemVybyBiYXNlZFxuICAgICAgICBtYXNrZWRWYWx1ZSA9IHRoaXMudmFsdWUuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRlUGFydC5ZZWFyOlxuICAgICAgICBpZiAocGFydExlbmd0aCA9PT0gMikge1xuICAgICAgICAgIG1hc2tlZFZhbHVlID0gdGhpcy5wcmVwZW5kVmFsdWUoXG4gICAgICAgICAgICBwYXJzZUludCh0aGlzLnZhbHVlLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKS5zbGljZSgtMiksIDEwKSwgcGFydExlbmd0aCwgJzAnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtYXNrZWRWYWx1ZSA9IHRoaXMudmFsdWUuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0ZVBhcnQuSG91cnM6XG4gICAgICAgIGlmIChkYXRlUGFydEluZm8uZm9ybWF0LmluZGV4T2YoJ2gnKSAhPT0gLTEpIHtcbiAgICAgICAgICBtYXNrZWRWYWx1ZSA9IHRoaXMucHJlcGVuZFZhbHVlKFxuICAgICAgICAgICAgdGhpcy50b1R3ZWx2ZUhvdXJGb3JtYXQodGhpcy52YWx1ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkpLCBwYXJ0TGVuZ3RoLCAnMCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1hc2tlZFZhbHVlID0gdGhpcy52YWx1ZS5nZXRIb3VycygpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEYXRlUGFydC5NaW51dGVzOlxuICAgICAgICBtYXNrZWRWYWx1ZSA9IHRoaXMudmFsdWUuZ2V0TWludXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRGF0ZVBhcnQuU2Vjb25kczpcbiAgICAgICAgbWFza2VkVmFsdWUgPSB0aGlzLnZhbHVlLmdldFNlY29uZHMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIERhdGVQYXJ0LkFtUG06XG4gICAgICAgIG1hc2tlZFZhbHVlID0gdGhpcy52YWx1ZS5nZXRIb3VycygpID49IDEyID8gJ1BNJyA6ICdBTSc7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChkYXRlUGFydEluZm8udHlwZSAhPT0gRGF0ZVBhcnQuQW1QbSkge1xuICAgICAgcmV0dXJuIHRoaXMucHJlcGVuZFZhbHVlKG1hc2tlZFZhbHVlLCBwYXJ0TGVuZ3RoLCAnMCcpO1xuICAgIH1cblxuICAgIHJldHVybiBtYXNrZWRWYWx1ZTtcbiAgfVxuXG4gIHByaXZhdGUgcHJlcGVuZFZhbHVlKHZhbHVlOiBudW1iZXIsIHBhcnRMZW5ndGg6IG51bWJlciwgcHJlcGVuZENoYXI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIChwcmVwZW5kQ2hhciArIHZhbHVlLnRvU3RyaW5nKCkpLnNsaWNlKC1wYXJ0TGVuZ3RoKTtcbiAgfVxuXG4gIHByaXZhdGUgc3BpbihldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgc3dpdGNoIChldmVudC5rZXkpIHtcbiAgICAgIGNhc2UgS0VZUy5VUF9BUlJPVzpcbiAgICAgIGNhc2UgS0VZUy5VUF9BUlJPV19JRTpcbiAgICAgICAgdGhpcy5pbmNyZW1lbnQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEtFWVMuRE9XTl9BUlJPVzpcbiAgICAgIGNhc2UgS0VZUy5ET1dOX0FSUk9XX0lFOlxuICAgICAgICB0aGlzLmRlY3JlbWVudCgpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGlucHV0SXNDb21wbGV0ZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dFZhbHVlLmluZGV4T2YodGhpcy5wcm9tcHRDaGFyKSA9PT0gLTE7XG4gIH1cblxuICBwcml2YXRlIGlzVmFsaWREYXRlKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZGF0ZSAmJiBkYXRlLmdldFRpbWUgJiYgIWlzTmFOKGRhdGUuZ2V0VGltZSgpKTtcbiAgfVxuXG4gICAgLy8gVE9ETzogbW92ZSBwYXJzZURhdGUgdG8gdXRpbHNcbiAgICBwdWJsaWMgcGFyc2VEYXRlKHZhbDogc3RyaW5nKTogRGF0ZSB8IG51bGwge1xuICAgIGlmICghdmFsKSB7IHJldHVybiBudWxsOyB9XG4gICAgcmV0dXJuIERhdGVQaWNrZXJVdGlsLnBhcnNlVmFsdWVGcm9tTWFzayh2YWwsIHRoaXMuX2lucHV0RGF0ZVBhcnRzLCB0aGlzLnByb21wdENoYXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBtb3ZlQ3Vyc29yKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgY29uc3QgdmFsdWUgPSAoZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlO1xuICAgIHN3aXRjaCAoZXZlbnQua2V5KSB7XG4gICAgICBjYXNlIEtFWVMuTEVGVF9BUlJPVzpcbiAgICAgIGNhc2UgS0VZUy5MRUZUX0FSUk9XX0lFOlxuICAgICAgICBpZiAoZXZlbnQuY3RybEtleSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLmdldE5ld1Bvc2l0aW9uKHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEtFWVMuUklHSFRfQVJST1c6XG4gICAgICBjYXNlIEtFWVMuUklHSFRfQVJST1dfSUU6XG4gICAgICAgIGlmIChldmVudC5jdHJsS2V5KSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlKHRoaXMuZ2V0TmV3UG9zaXRpb24odmFsdWUsIDEpKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTW92ZSB0aGUgY3Vyc29yIGluIGEgc3BlY2lmaWMgZGlyZWN0aW9uIHVudGlsIGl0IHJlYWNoZXMgYSBkYXRlL3RpbWUgc2VwYXJhdG9yLlxuICAgKiBUaGVuIHJldHVybiBpdHMgaW5kZXguXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSBUaGUgc3RyaW5nIGl0IG9wZXJhdGVzIG9uLlxuICAgKiBAcGFyYW0gZGlyZWN0aW9uIDAgaXMgbGVmdCwgMSBpcyByaWdodC4gRGVmYXVsdCBpcyAwLlxuICAgKi9cbiAgcHJpdmF0ZSBnZXROZXdQb3NpdGlvbih2YWx1ZTogc3RyaW5nLCBkaXJlY3Rpb24gPSAwKTogbnVtYmVyIHtcbiAgICBjb25zdCBsaXRlcmFscyA9IHRoaXMuX2lucHV0RGF0ZVBhcnRzLmZpbHRlcihwID0+IHAudHlwZSA9PT0gRGF0ZVBhcnQuTGl0ZXJhbCk7XG4gICAgbGV0IGN1cnNvclBvcyA9IHRoaXMuc2VsZWN0aW9uU3RhcnQ7XG4gICAgaWYgKCFkaXJlY3Rpb24pIHtcbiAgICAgIGRvIHtcbiAgICAgICAgY3Vyc29yUG9zID0gY3Vyc29yUG9zID4gMCA/IC0tY3Vyc29yUG9zIDogY3Vyc29yUG9zO1xuICAgICAgfSB3aGlsZSAoIWxpdGVyYWxzLnNvbWUobCA9PiBsLmVuZCA9PT0gY3Vyc29yUG9zKSAmJiBjdXJzb3JQb3MgPiAwKTtcbiAgICAgIHJldHVybiBjdXJzb3JQb3M7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvIHtcbiAgICAgICAgY3Vyc29yUG9zKys7XG4gICAgICB9IHdoaWxlICghbGl0ZXJhbHMuc29tZShsID0+IGwuc3RhcnQgPT09IGN1cnNvclBvcykgJiYgY3Vyc29yUG9zIDwgdmFsdWUubGVuZ3RoKTtcbiAgICAgIHJldHVybiBjdXJzb3JQb3M7XG4gICAgfVxuICB9XG59XG5cbkBOZ01vZHVsZSh7XG4gIGRlY2xhcmF0aW9uczogW0lneERhdGVUaW1lRWRpdG9yRGlyZWN0aXZlXSxcbiAgZXhwb3J0czogW0lneERhdGVUaW1lRWRpdG9yRGlyZWN0aXZlXVxufSlcbmV4cG9ydCBjbGFzcyBJZ3hEYXRlVGltZUVkaXRvck1vZHVsZSB7IH1cbiJdfQ==