import { __decorate, __extends, __read, __spread } from "tslib";
import { Injectable } from '@angular/core';
import { first } from 'rxjs/operators';
import { IgxGridNavigationService } from './grid-navigation.service';
import { HORIZONTAL_NAV_KEYS, HEADER_KEYS } from '../core/utils';
/** @hidden */
var IgxGridMRLNavigationService = /** @class */ (function (_super) {
    __extends(IgxGridMRLNavigationService, _super);
    function IgxGridMRLNavigationService() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    IgxGridMRLNavigationService.prototype.getNextPosition = function (rowIndex, colIndex, key, shift, ctrl, event) {
        if (!this.activeNode.layout) {
            this.activeNode.layout = this.layout(this.activeNode.column || 0);
        }
        switch (key) {
            case 'tab':
            case ' ':
            case 'spacebar':
            case 'space':
            case 'escape':
            case 'esc':
            case 'enter':
            case 'f2':
                _super.prototype.getNextPosition.call(this, rowIndex, colIndex, key, shift, ctrl, event);
                break;
            case 'end':
                rowIndex = ctrl ? this.findLastDataRowIndex() : this.activeNode.row;
                colIndex = ctrl ? this.lastColIndexPerMRLBlock(this.lastIndexPerRow) : this.lastIndexPerRow;
                break;
            case 'home':
                rowIndex = ctrl ? this.findFirstDataRowIndex() : this.activeNode.row;
                colIndex = ctrl ? 0 : this.firstIndexPerRow;
                break;
            case 'arrowleft':
            case 'left':
                colIndex = ctrl ? this.firstIndexPerRow : this.getNextHorizontalCellPosition(true).column;
                break;
            case 'arrowright':
            case 'right':
                colIndex = ctrl ? this.lastIndexPerRow : this.getNextHorizontalCellPosition().column;
                break;
            case 'arrowup':
            case 'up':
                var prevPos = this.getNextVerticalPosition(true);
                colIndex = ctrl ? this.activeNode.column : prevPos.column;
                rowIndex = ctrl ? this.findFirstDataRowIndex() : prevPos.row;
                break;
            case 'arrowdown':
            case 'down':
                var nextPos = this.getNextVerticalPosition();
                colIndex = ctrl ? this.activeNode.column : nextPos.column;
                rowIndex = ctrl ? this.findLastDataRowIndex() : nextPos.row;
                break;
            default:
                return;
        }
        var nextLayout = this.layout(colIndex);
        var newLayout = key.includes('up') || key.includes('down') ? { rowStart: nextLayout.rowStart } : { colStart: nextLayout.colStart };
        Object.assign(this.activeNode.layout, newLayout, { rowEnd: nextLayout.rowEnd });
        if (ctrl && (key === 'home' || key === 'end')) {
            this.activeNode.layout = nextLayout;
        }
        return { rowIndex: rowIndex, colIndex: colIndex };
    };
    IgxGridMRLNavigationService.prototype.isValidPosition = function (rowIndex, colIndex) {
        if (rowIndex < 0 || colIndex < 0 || this.grid.dataView.length - 1 < rowIndex ||
            Math.max.apply(Math, __spread(this.grid.visibleColumns.map(function (col) { return col.visibleIndex; }))) < colIndex ||
            (this.activeNode.column !== colIndex && !this.isDataRow(rowIndex, true))) {
            return false;
        }
        return true;
    };
    IgxGridMRLNavigationService.prototype.shouldPerformVerticalScroll = function (targetRowIndex, visibleColIndex) {
        if (!_super.prototype.shouldPerformVerticalScroll.call(this, targetRowIndex, visibleColIndex)) {
            return false;
        }
        if (!this.isDataRow(targetRowIndex)) {
            return _super.prototype.shouldPerformVerticalScroll.call(this, targetRowIndex, visibleColIndex);
        }
        var targetRow = _super.prototype.getRowElementByIndex.call(this, targetRowIndex);
        var containerHeight = this.grid.calcHeight ? Math.ceil(this.grid.calcHeight) : 0;
        var scrollPos = this.getVerticalScrollPositions(targetRowIndex, visibleColIndex);
        return (!targetRow || targetRow.offsetTop + scrollPos.topOffset < Math.abs(this.containerTopOffset)
            || containerHeight && containerHeight < scrollPos.rowBottom - Math.ceil(this.scrollTop));
    };
    IgxGridMRLNavigationService.prototype.isColumnFullyVisible = function (visibleColIndex) {
        var targetCol = this.grid.getColumnByVisibleIndex(visibleColIndex);
        if (this.isParentColumnFullyVisible(targetCol === null || targetCol === void 0 ? void 0 : targetCol.parent) || _super.prototype.isColumnPinned.call(this, visibleColIndex, this.forOfDir())) {
            return true;
        }
        var scrollPos = this.getChildColumnScrollPositions(visibleColIndex);
        var colWidth = scrollPos.rightScroll - scrollPos.leftScroll;
        if (this.displayContainerWidth < colWidth && this.displayContainerScrollLeft === scrollPos.leftScroll) {
            return true;
        }
        return this.displayContainerWidth >= scrollPos.rightScroll - this.displayContainerScrollLeft &&
            this.displayContainerScrollLeft <= scrollPos.leftScroll;
    };
    IgxGridMRLNavigationService.prototype.isParentColumnFullyVisible = function (parent) {
        if (!this.forOfDir().getScroll().clientWidth || (parent === null || parent === void 0 ? void 0 : parent.pinned)) {
            return true;
        }
        var index = this.forOfDir().igxForOf.indexOf(parent);
        return this.displayContainerWidth >= this.forOfDir().getColumnScrollLeft(index + 1) - this.displayContainerScrollLeft &&
            this.displayContainerScrollLeft <= this.forOfDir().getColumnScrollLeft(index);
    };
    IgxGridMRLNavigationService.prototype.getChildColumnScrollPositions = function (visibleColIndex) {
        var targetCol = this.grid.getColumnByVisibleIndex(visibleColIndex);
        var parentVIndex = this.forOfDir().igxForOf.indexOf(targetCol.parent);
        var leftScroll = this.forOfDir().getColumnScrollLeft(parentVIndex);
        var rightScroll = this.forOfDir().getColumnScrollLeft(parentVIndex + 1);
        targetCol.parent.children.forEach(function (c) {
            if (c.rowStart >= targetCol.rowStart && c.visibleIndex < targetCol.visibleIndex) {
                leftScroll += parseInt(c.width, 10);
            }
            if (c.rowStart <= targetCol.rowStart && c.visibleIndex > targetCol.visibleIndex) {
                rightScroll -= parseInt(c.width, 10);
            }
        });
        return { leftScroll: leftScroll, rightScroll: rightScroll };
    };
    IgxGridMRLNavigationService.prototype.getVerticalScrollPositions = function (rowIndex, visibleIndex) {
        var targetCol = this.grid.getColumnByVisibleIndex(visibleIndex);
        var rowSpan = targetCol.rowEnd && targetCol.rowEnd - targetCol.rowStart ? targetCol.rowEnd - targetCol.rowStart : 1;
        var topOffset = this.grid.defaultRowHeight * (targetCol.rowStart - 1);
        var rowTop = this.grid.verticalScrollContainer.sizesCache[rowIndex] + topOffset;
        return { topOffset: topOffset, rowTop: rowTop, rowBottom: rowTop + (this.grid.defaultRowHeight * rowSpan) };
    };
    IgxGridMRLNavigationService.prototype.performHorizontalScrollToCell = function (visibleColumnIndex, cb) {
        if (!this.shouldPerformHorizontalScroll(visibleColumnIndex)) {
            return;
        }
        var scrollPos = this.getChildColumnScrollPositions(visibleColumnIndex);
        var startScroll = scrollPos.rightScroll - this.displayContainerScrollLeft;
        var nextScroll = !(this.displayContainerScrollLeft <= scrollPos.leftScroll) && this.displayContainerWidth >= startScroll ?
            scrollPos.leftScroll : scrollPos.rightScroll - this.displayContainerWidth;
        this.forOfDir().getScroll().scrollLeft = nextScroll;
        this.grid.parentVirtDir.onChunkLoad
            .pipe(first())
            .subscribe(function () {
            if (cb) {
                cb();
            }
        });
    };
    IgxGridMRLNavigationService.prototype.performVerticalScrollToCell = function (rowIndex, visibleColIndex, cb) {
        var _a;
        var children = (_a = this.parentByChildIndex(visibleColIndex || 0)) === null || _a === void 0 ? void 0 : _a.children;
        if (!_super.prototype.isDataRow.call(this, rowIndex) || (children && children.length < 2)) {
            return _super.prototype.performVerticalScrollToCell.call(this, rowIndex, visibleColIndex, cb);
        }
        var containerHeight = this.grid.calcHeight ? Math.ceil(this.grid.calcHeight) : 0;
        var pos = this.getVerticalScrollPositions(rowIndex, visibleColIndex);
        var row = _super.prototype.getRowElementByIndex.call(this, rowIndex);
        if ((this.scrollTop > pos.rowTop) && (!row || row.offsetTop + pos.topOffset < Math.abs(this.containerTopOffset))) {
            pos.topOffset === 0 ? this.grid.verticalScrollContainer.scrollTo(rowIndex) :
                this.grid.verticalScrollContainer.scrollPosition = pos.rowTop;
        }
        else {
            this.grid.verticalScrollContainer.addScrollTop(Math.abs(pos.rowBottom - this.scrollTop - containerHeight));
        }
        this.grid.verticalScrollContainer.onChunkLoad
            .pipe(first()).subscribe(function () {
            if (cb) {
                cb();
            }
        });
    };
    IgxGridMRLNavigationService.prototype.getNextHorizontalCellPosition = function (previous) {
        var _this = this;
        if (previous === void 0) { previous = false; }
        var parent = this.parentByChildIndex(this.activeNode.column);
        if (!this.hasNextHorizontalPosition(previous, parent)) {
            return { row: this.activeNode.row, column: this.activeNode.column };
        }
        var columns = previous ? parent.children.filter(function (c) { return c.rowStart <= _this.activeNode.layout.rowStart; })
            .sort(function (a, b) { return b.visibleIndex - a.visibleIndex; }) : parent.children.filter(function (c) { return c.rowStart <= _this.activeNode.layout.rowStart; });
        var column = columns.find(function (col) { return previous ?
            col.visibleIndex < _this.activeNode.column && _this.rowEnd(col) > _this.activeNode.layout.rowStart :
            col.visibleIndex > _this.activeNode.column && col.colStart > _this.activeNode.layout.colStart; });
        if (!column || (previous && this.activeNode.layout.colStart === 1)) {
            var index_1 = previous ? parent.visibleIndex - 1 : parent.visibleIndex + 1;
            var children = this.grid.columnList.find(function (cols) { return cols.columnLayout && cols.visibleIndex === index_1; }).children;
            column = previous ? children.toArray().reverse().find(function (child) { return child.rowStart <= _this.activeNode.layout.rowStart; }) :
                children.find(function (child) { return _this.rowEnd(child) > _this.activeNode.layout.rowStart && child.colStart === 1; });
        }
        return { row: this.activeNode.row, column: column.visibleIndex };
    };
    IgxGridMRLNavigationService.prototype.getNextVerticalPosition = function (previous) {
        if (previous === void 0) { previous = false; }
        this.activeNode.column = this.activeNode.column || 0;
        if (!this.hasNextVerticalPosition(previous)) {
            return { row: this.activeNode.row, column: this.activeNode.column };
        }
        var currentRowStart = this.grid.getColumnByVisibleIndex(this.activeNode.column).rowStart;
        var nextBlock = !this.isDataRow(this.activeNode.row) ||
            (previous ? currentRowStart === 1 : currentRowStart === this.lastRowStartPerBlock());
        var nextRI = previous ? this.activeNode.row - 1 : this.activeNode.row + 1;
        if (nextBlock && !this.isDataRow(nextRI)) {
            return { row: nextRI, column: this.activeNode.column };
        }
        var children = this.parentByChildIndex(this.activeNode.column).children;
        var col = previous ? this.getPreviousRowIndex(children, nextBlock) : this.getNextRowIndex(children, nextBlock);
        return { row: nextBlock ? nextRI : this.activeNode.row, column: col.visibleIndex };
    };
    IgxGridMRLNavigationService.prototype.getNextRowIndex = function (children, next) {
        var _this = this;
        var rowStart = next ? 1 : this.rowEnd(this.grid.getColumnByVisibleIndex(this.activeNode.column));
        var col = children.filter(function (c) { return c.rowStart === rowStart; });
        return col.find(function (co) { return co.colStart === _this.activeNode.layout.colStart; }) ||
            col.sort(function (a, b) { return b.visibleIndex - a.visibleIndex; }).find(function (co) { return co.colStart <= _this.activeNode.layout.colStart; });
    };
    IgxGridMRLNavigationService.prototype.getPreviousRowIndex = function (children, prev) {
        var _this = this;
        var end = prev ? Math.max.apply(Math, __spread(children.map(function (c) { return _this.rowEnd(c); }))) :
            this.grid.getColumnByVisibleIndex(this.activeNode.column).rowStart;
        var col = children.filter(function (c) { return _this.rowEnd(c) === end; });
        return col.find(function (co) { return co.colStart === _this.activeNode.layout.colStart; }) ||
            col.sort(function (a, b) { return b.visibleIndex - a.visibleIndex; }).find(function (co) { return co.colStart <= _this.activeNode.layout.colStart; });
    };
    IgxGridMRLNavigationService.prototype.headerNavigation = function (event) {
        var key = event.key.toLowerCase();
        if (!HEADER_KEYS.has(key)) {
            return;
        }
        event.preventDefault();
        if (!this.activeNode.layout) {
            this.activeNode.layout = this.layout(this.activeNode.column || 0);
        }
        var alt = event.altKey;
        var ctrl = event.ctrlKey;
        this.performHeaderKeyCombination(this.grid.getColumnByVisibleIndex(this.activeNode.column), key, event.shiftKey, ctrl, alt, event);
        if (!ctrl && !alt && (key.includes('down') || key.includes('up'))) {
            var children = this.parentByChildIndex(this.activeNode.column).children;
            var col = key.includes('down') ? this.getNextRowIndex(children, false) : this.getPreviousRowIndex(children, false);
            if (!col) {
                return;
            }
            this.activeNode.column = col.visibleIndex;
            var newLayout = this.layout(this.activeNode.column);
            Object.assign(this.activeNode.layout, { rowStart: newLayout.rowStart, rowEnd: newLayout.rowEnd });
            return;
        }
        this.horizontalNav(event, key, -1);
    };
    IgxGridMRLNavigationService.prototype.horizontalNav = function (event, key, rowIndex) {
        var ctrl = event.ctrlKey;
        if (!HORIZONTAL_NAV_KEYS.has(key) || event.altKey) {
            return;
        }
        this.activeNode.row = rowIndex;
        if ((key.includes('left') || key === 'home') && this.activeNode.column > 0) {
            this.activeNode.column = ctrl || key === 'home' ? this.firstIndexPerRow : this.getNextHorizontalCellPosition(true).column;
        }
        if ((key.includes('right') || key === 'end') && this.activeNode.column !== this.lastIndexPerRow) {
            this.activeNode.column = ctrl || key === 'end' ? this.lastIndexPerRow : this.getNextHorizontalCellPosition().column;
        }
        var newLayout = this.layout(this.activeNode.column);
        Object.assign(this.activeNode.layout, { colStart: newLayout.colStart, rowEnd: newLayout.rowEnd });
        this.performHorizontalScrollToCell(this.activeNode.column);
    };
    Object.defineProperty(IgxGridMRLNavigationService.prototype, "lastIndexPerRow", {
        get: function () {
            var _this = this;
            var children = this.grid.visibleColumns.find(function (c) { return c.visibleIndex === _this.lastLayoutIndex && c.columnLayout; })
                .children.toArray().reverse();
            var column = children.find(function (co) { return co.rowStart === _this.activeNode.layout.rowStart; }) ||
                children.find(function (co) { return co.rowStart <= _this.activeNode.layout.rowStart; });
            return column.visibleIndex;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxGridMRLNavigationService.prototype, "firstIndexPerRow", {
        get: function () {
            var _this = this;
            var children = this.grid.visibleColumns.find(function (c) { return c.visibleIndex === 0 && c.columnLayout; }).children;
            var column = children.find(function (co) { return co.rowStart === _this.activeNode.layout.rowStart; }) ||
                children.find(function (co) { return co.rowStart <= _this.activeNode.layout.rowStart; });
            return column.visibleIndex;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxGridMRLNavigationService.prototype, "lastLayoutIndex", {
        get: function () {
            return Math.max.apply(Math, __spread(this.grid.visibleColumns.filter(function (c) { return c.columnLayout; }).map(function (col) { return col.visibleIndex; })));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxGridMRLNavigationService.prototype, "scrollTop", {
        get: function () {
            return Math.abs(this.grid.verticalScrollContainer.getScroll().scrollTop);
        },
        enumerable: true,
        configurable: true
    });
    IgxGridMRLNavigationService.prototype.lastColIndexPerMRLBlock = function (visibleIndex) {
        if (visibleIndex === void 0) { visibleIndex = this.activeNode.column; }
        return this.parentByChildIndex(visibleIndex).children.last.visibleIndex;
    };
    IgxGridMRLNavigationService.prototype.lastRowStartPerBlock = function (visibleIndex) {
        if (visibleIndex === void 0) { visibleIndex = this.activeNode.column; }
        return Math.max.apply(Math, __spread(this.parentByChildIndex(visibleIndex).children.map(function (c) { return c.rowStart; })));
    };
    IgxGridMRLNavigationService.prototype.rowEnd = function (column) {
        return column.rowEnd && column.rowEnd - column.rowStart ? column.rowStart + column.rowEnd - column.rowStart : column.rowStart + 1;
    };
    /**
     * @hidden
     * @internal
     */
    IgxGridMRLNavigationService.prototype.layout = function (visibleIndex) {
        var column = this.grid.getColumnByVisibleIndex(visibleIndex);
        return { colStart: column.colStart, rowStart: column.rowStart,
            colEnd: column.colEnd, rowEnd: column.rowEnd, columnVisibleIndex: column.visibleIndex };
    };
    IgxGridMRLNavigationService.prototype.parentByChildIndex = function (visibleIndex) {
        var _a;
        return (_a = this.grid.getColumnByVisibleIndex(visibleIndex)) === null || _a === void 0 ? void 0 : _a.parent;
    };
    IgxGridMRLNavigationService.prototype.hasNextHorizontalPosition = function (previous, parent) {
        if (previous === void 0) { previous = false; }
        if (previous && parent.visibleIndex === 0 && this.activeNode.layout.colStart === 1 ||
            !previous && parent.visibleIndex === this.lastLayoutIndex && this.activeNode.column === this.lastIndexPerRow) {
            return false;
        }
        return true;
    };
    IgxGridMRLNavigationService.prototype.hasNextVerticalPosition = function (prev) {
        if (prev === void 0) { prev = false; }
        if ((prev && this.activeNode.row === 0 && (!this.isDataRow(this.activeNode.row) || this.activeNode.layout.rowStart === 1)) ||
            (!prev && this.activeNode.row >= this.grid.dataView.length - 1 && this.activeNode.column === this.lastColIndexPerMRLBlock())) {
            return false;
        }
        return true;
    };
    IgxGridMRLNavigationService = __decorate([
        Injectable()
    ], IgxGridMRLNavigationService);
    return IgxGridMRLNavigationService;
}(IgxGridNavigationService));
export { IgxGridMRLNavigationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1tcmwtbmF2aWdhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vaWduaXRldWktYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9ncmlkcy9ncmlkLW1ybC1uYXZpZ2F0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXZDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFakUsY0FBYztBQUVkO0lBQWlELCtDQUF3QjtJQUF6RTs7SUFtVEEsQ0FBQztJQWhUYSxxREFBZSxHQUF6QixVQUEwQixRQUFnQixFQUFFLFFBQWdCLEVBQUUsR0FBVyxFQUFFLEtBQWMsRUFBRSxJQUFhLEVBQUUsS0FBb0I7UUFDMUgsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFO1lBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDckU7UUFDRCxRQUFRLEdBQUcsRUFBRTtZQUNULEtBQUssS0FBSyxDQUFDO1lBQ1gsS0FBSyxHQUFHLENBQUM7WUFDVCxLQUFLLFVBQVUsQ0FBQztZQUNoQixLQUFLLE9BQU8sQ0FBQztZQUNiLEtBQUssUUFBUSxDQUFDO1lBQ2QsS0FBSyxLQUFLLENBQUM7WUFDWCxLQUFLLE9BQU8sQ0FBQztZQUNiLEtBQUssSUFBSTtnQkFDTCxpQkFBTSxlQUFlLFlBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFD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QU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFTyw2REFBdUIsR0FBL0IsVUFBZ0MsSUFBWTtRQUFaLHFCQUFBLEVBQUEsWUFBWTtRQUN4QyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFFBQVEsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUN0SCxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUMsRUFBRTtZQUM5SCxPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFsVFEsMkJBQTJCO1FBRHZDLFVBQVUsRUFBRTtPQUNBLDJCQUEyQixDQW1UdkM7SUFBRCxrQ0FBQztDQUFBLEFBblRELENBQWlELHdCQUF3QixHQW1UeEU7U0FuVFksMkJBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSWd4R3JpZEJhc2VEaXJlY3RpdmUgfSBmcm9tICcuL2dyaWQtYmFzZS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgZmlyc3QgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBJZ3hDb2x1bW5Db21wb25lbnQgfSBmcm9tICcuL2NvbHVtbnMvY29sdW1uLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJZ3hHcmlkTmF2aWdhdGlvblNlcnZpY2UgfSBmcm9tICcuL2dyaWQtbmF2aWdhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IEhPUklaT05UQUxfTkFWX0tFWVMsIEhFQURFUl9LRVlTIH0gZnJvbSAnLi4vY29yZS91dGlscyc7XG5cbi8qKiBAaGlkZGVuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgSWd4R3JpZE1STE5hdmlnYXRpb25TZXJ2aWNlIGV4dGVuZHMgSWd4R3JpZE5hdmlnYXRpb25TZXJ2aWNlIHtcbiAgICBwdWJsaWMgZ3JpZDogSWd4R3JpZEJhc2VEaXJlY3RpdmU7XG5cbiAgICBwcm90ZWN0ZWQgZ2V0TmV4dFBvc2l0aW9uKHJvd0luZGV4OiBudW1iZXIsIGNvbEluZGV4OiBudW1iZXIsIGtleTogc3RyaW5nLCBzaGlmdDogYm9vbGVhbiwgY3RybDogYm9vbGVhbiwgZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZU5vZGUubGF5b3V0KSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0ID0gdGhpcy5sYXlvdXQodGhpcy5hY3RpdmVOb2RlLmNvbHVtbiB8fCAwKTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgY2FzZSAndGFiJzpcbiAgICAgICAgICAgIGNhc2UgJyAnOlxuICAgICAgICAgICAgY2FzZSAnc3BhY2ViYXInOlxuICAgICAgICAgICAgY2FzZSAnc3BhY2UnOlxuICAgICAgICAgICAgY2FzZSAnZXNjYXBlJzpcbiAgICAgICAgICAgIGNhc2UgJ2VzYyc6XG4gICAgICAgICAgICBjYXNlICdlbnRlcic6XG4gICAgICAgICAgICBjYXNlICdmMic6XG4gICAgICAgICAgICAgICAgc3VwZXIuZ2V0TmV4dFBvc2l0aW9uKHJvd0luZGV4LCBjb2xJbmRleCwga2V5LCBzaGlmdCwgY3RybCwgZXZlbnQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZW5kJzpcbiAgICAgICAgICAgICAgICByb3dJbmRleCA9IGN0cmwgPyB0aGlzLmZpbmRMYXN0RGF0YVJvd0luZGV4KCkgOiB0aGlzLmFjdGl2ZU5vZGUucm93O1xuICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gY3RybCA/IHRoaXMubGFzdENvbEluZGV4UGVyTVJMQmxvY2sodGhpcy5sYXN0SW5kZXhQZXJSb3cpIDogdGhpcy5sYXN0SW5kZXhQZXJSb3c7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdob21lJzpcbiAgICAgICAgICAgICAgICByb3dJbmRleCA9IGN0cmwgPyB0aGlzLmZpbmRGaXJzdERhdGFSb3dJbmRleCgpIDogdGhpcy5hY3RpdmVOb2RlLnJvdztcbiAgICAgICAgICAgICAgICBjb2xJbmRleCA9IGN0cmwgPyAwIDogdGhpcy5maXJzdEluZGV4UGVyUm93O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYXJyb3dsZWZ0JzpcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gY3RybCA/IHRoaXMuZmlyc3RJbmRleFBlclJvdyA6IHRoaXMuZ2V0TmV4dEhvcml6b250YWxDZWxsUG9zaXRpb24odHJ1ZSkuY29sdW1uO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYXJyb3dyaWdodCc6XG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgY29sSW5kZXggPSBjdHJsID8gdGhpcy5sYXN0SW5kZXhQZXJSb3cgOiB0aGlzLmdldE5leHRIb3Jpem9udGFsQ2VsbFBvc2l0aW9uKCkuY29sdW1uO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYXJyb3d1cCc6XG4gICAgICAgICAgICBjYXNlICd1cCc6XG4gICAgICAgICAgICAgICAgY29uc3QgcHJldlBvcyA9IHRoaXMuZ2V0TmV4dFZlcnRpY2FsUG9zaXRpb24odHJ1ZSk7XG4gICAgICAgICAgICAgICAgY29sSW5kZXggPSBjdHJsID8gdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiA6IHByZXZQb3MuY29sdW1uO1xuICAgICAgICAgICAgICAgIHJvd0luZGV4ID0gY3RybCA/IHRoaXMuZmluZEZpcnN0RGF0YVJvd0luZGV4KCkgOiBwcmV2UG9zLnJvdztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2Fycm93ZG93bic6XG4gICAgICAgICAgICBjYXNlICdkb3duJzpcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0UG9zID0gdGhpcy5nZXROZXh0VmVydGljYWxQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gY3RybCA/IHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4gOiBuZXh0UG9zLmNvbHVtbjtcbiAgICAgICAgICAgICAgICByb3dJbmRleCA9IGN0cmwgPyB0aGlzLmZpbmRMYXN0RGF0YVJvd0luZGV4KCkgOiBuZXh0UG9zLnJvdztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5leHRMYXlvdXQgPSB0aGlzLmxheW91dChjb2xJbmRleCk7XG4gICAgICAgIGNvbnN0IG5ld0xheW91dCA9IGtleS5pbmNsdWRlcygndXAnKSB8fCBrZXkuaW5jbHVkZXMoJ2Rvd24nKSA/IHtyb3dTdGFydDogbmV4dExheW91dC5yb3dTdGFydH0gOiB7Y29sU3RhcnQ6IG5leHRMYXlvdXQuY29sU3RhcnR9O1xuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQsIG5ld0xheW91dCwge3Jvd0VuZDogbmV4dExheW91dC5yb3dFbmR9KTtcblxuICAgICAgICBpZiAoY3RybCAmJiAoa2V5ID09PSAnaG9tZScgfHwga2V5ID09PSAnZW5kJykpIHsgdGhpcy5hY3RpdmVOb2RlLmxheW91dCA9IG5leHRMYXlvdXQ7IH1cbiAgICAgICAgcmV0dXJuIHsgcm93SW5kZXgsIGNvbEluZGV4IH07XG4gICAgfVxuXG4gICAgcHVibGljIGlzVmFsaWRQb3NpdGlvbihyb3dJbmRleDogbnVtYmVyLCBjb2xJbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChyb3dJbmRleCA8IDAgfHwgY29sSW5kZXggPCAwIHx8IHRoaXMuZ3JpZC5kYXRhVmlldy5sZW5ndGggLSAxIDwgcm93SW5kZXggfHxcbiAgICAgICAgICAgIE1hdGgubWF4KC4uLnRoaXMuZ3JpZC52aXNpYmxlQ29sdW1ucy5tYXAoY29sID0+IGNvbC52aXNpYmxlSW5kZXgpKSA8IGNvbEluZGV4IHx8XG4gICAgICAgICAgICAodGhpcy5hY3RpdmVOb2RlLmNvbHVtbiAhPT0gY29sSW5kZXggJiYgIXRoaXMuaXNEYXRhUm93KHJvd0luZGV4LCB0cnVlKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2hvdWxkUGVyZm9ybVZlcnRpY2FsU2Nyb2xsKHRhcmdldFJvd0luZGV4OiBudW1iZXIsIHZpc2libGVDb2xJbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICghc3VwZXIuc2hvdWxkUGVyZm9ybVZlcnRpY2FsU2Nyb2xsKHRhcmdldFJvd0luZGV4LCB2aXNpYmxlQ29sSW5kZXgpKSB7IHJldHVybiBmYWxzZTsgfVxuICAgICAgICBpZiAoIXRoaXMuaXNEYXRhUm93KHRhcmdldFJvd0luZGV4KSkgeyByZXR1cm4gc3VwZXIuc2hvdWxkUGVyZm9ybVZlcnRpY2FsU2Nyb2xsKHRhcmdldFJvd0luZGV4LCB2aXNpYmxlQ29sSW5kZXgpOyB9XG5cbiAgICAgICAgY29uc3QgdGFyZ2V0Um93ID0gc3VwZXIuZ2V0Um93RWxlbWVudEJ5SW5kZXgodGFyZ2V0Um93SW5kZXgpO1xuICAgICAgICBjb25zdCBjb250YWluZXJIZWlnaHQgPSB0aGlzLmdyaWQuY2FsY0hlaWdodCA/IE1hdGguY2VpbCh0aGlzLmdyaWQuY2FsY0hlaWdodCkgOiAwO1xuICAgICAgICBjb25zdCBzY3JvbGxQb3MgPSB0aGlzLmdldFZlcnRpY2FsU2Nyb2xsUG9zaXRpb25zKHRhcmdldFJvd0luZGV4LCB2aXNpYmxlQ29sSW5kZXgpO1xuICAgICAgICByZXR1cm4gKCF0YXJnZXRSb3cgfHwgdGFyZ2V0Um93Lm9mZnNldFRvcCArIHNjcm9sbFBvcy50b3BPZmZzZXQgPCBNYXRoLmFicyh0aGlzLmNvbnRhaW5lclRvcE9mZnNldClcbiAgICAgICAgICAgIHx8IGNvbnRhaW5lckhlaWdodCAmJiBjb250YWluZXJIZWlnaHQgPCBzY3JvbGxQb3Mucm93Qm90dG9tIC0gIE1hdGguY2VpbCh0aGlzLnNjcm9sbFRvcCkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBpc0NvbHVtbkZ1bGx5VmlzaWJsZSh2aXNpYmxlQ29sSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCB0YXJnZXRDb2wgPSB0aGlzLmdyaWQuZ2V0Q29sdW1uQnlWaXNpYmxlSW5kZXgodmlzaWJsZUNvbEluZGV4KTtcbiAgICAgICAgaWYgKHRoaXMuaXNQYXJlbnRDb2x1bW5GdWxseVZpc2libGUodGFyZ2V0Q29sPy5wYXJlbnQpIHx8IHN1cGVyLmlzQ29sdW1uUGlubmVkKHZpc2libGVDb2xJbmRleCwgdGhpcy5mb3JPZkRpcigpKSkgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgICAgIGNvbnN0IHNjcm9sbFBvcyA9IHRoaXMuZ2V0Q2hpbGRDb2x1bW5TY3JvbGxQb3NpdGlvbnModmlzaWJsZUNvbEluZGV4KTtcbiAgICAgICAgY29uc3QgY29sV2lkdGggPSBzY3JvbGxQb3MucmlnaHRTY3JvbGwgLSBzY3JvbGxQb3MubGVmdFNjcm9sbDtcbiAgICAgICAgaWYgKHRoaXMuZGlzcGxheUNvbnRhaW5lcldpZHRoIDwgY29sV2lkdGggJiYgdGhpcy5kaXNwbGF5Q29udGFpbmVyU2Nyb2xsTGVmdCA9PT0gc2Nyb2xsUG9zLmxlZnRTY3JvbGwpIHsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGxheUNvbnRhaW5lcldpZHRoID49IHNjcm9sbFBvcy5yaWdodFNjcm9sbCAtIHRoaXMuZGlzcGxheUNvbnRhaW5lclNjcm9sbExlZnQgJiZcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheUNvbnRhaW5lclNjcm9sbExlZnQgPD0gc2Nyb2xsUG9zLmxlZnRTY3JvbGw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1BhcmVudENvbHVtbkZ1bGx5VmlzaWJsZShwYXJlbnQ6IElneENvbHVtbkNvbXBvbmVudCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoIXRoaXMuZm9yT2ZEaXIoKS5nZXRTY3JvbGwoKS5jbGllbnRXaWR0aCB8fCBwYXJlbnQ/LnBpbm5lZCkgeyByZXR1cm4gdHJ1ZTsgfVxuXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5mb3JPZkRpcigpLmlneEZvck9mLmluZGV4T2YocGFyZW50KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGxheUNvbnRhaW5lcldpZHRoID49IHRoaXMuZm9yT2ZEaXIoKS5nZXRDb2x1bW5TY3JvbGxMZWZ0KGluZGV4ICsgMSkgLSB0aGlzLmRpc3BsYXlDb250YWluZXJTY3JvbGxMZWZ0ICYmXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlDb250YWluZXJTY3JvbGxMZWZ0IDw9IHRoaXMuZm9yT2ZEaXIoKS5nZXRDb2x1bW5TY3JvbGxMZWZ0KGluZGV4KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldENoaWxkQ29sdW1uU2Nyb2xsUG9zaXRpb25zKHZpc2libGVDb2xJbmRleDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldENvbDogSWd4Q29sdW1uQ29tcG9uZW50ID0gdGhpcy5ncmlkLmdldENvbHVtbkJ5VmlzaWJsZUluZGV4KHZpc2libGVDb2xJbmRleCk7XG4gICAgICAgIGNvbnN0IHBhcmVudFZJbmRleCA9IHRoaXMuZm9yT2ZEaXIoKS5pZ3hGb3JPZi5pbmRleE9mKHRhcmdldENvbC5wYXJlbnQpO1xuICAgICAgICBsZXQgbGVmdFNjcm9sbCA9IHRoaXMuZm9yT2ZEaXIoKS5nZXRDb2x1bW5TY3JvbGxMZWZ0KHBhcmVudFZJbmRleCk7XG4gICAgICAgIGxldCByaWdodFNjcm9sbCA9IHRoaXMuZm9yT2ZEaXIoKS5nZXRDb2x1bW5TY3JvbGxMZWZ0KHBhcmVudFZJbmRleCArIDEpO1xuICAgICAgICB0YXJnZXRDb2wucGFyZW50LmNoaWxkcmVuLmZvckVhY2goKGMpID0+IHtcbiAgICAgICAgICAgIGlmIChjLnJvd1N0YXJ0ID49IHRhcmdldENvbC5yb3dTdGFydCAmJiBjLnZpc2libGVJbmRleCA8IHRhcmdldENvbC52aXNpYmxlSW5kZXgpIHtcbiAgICAgICAgICAgICAgICBsZWZ0U2Nyb2xsICs9IHBhcnNlSW50KGMud2lkdGgsIDEwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjLnJvd1N0YXJ0IDw9IHRhcmdldENvbC5yb3dTdGFydCAmJiBjLnZpc2libGVJbmRleCA+IHRhcmdldENvbC52aXNpYmxlSW5kZXgpIHtcbiAgICAgICAgICAgICAgICByaWdodFNjcm9sbCAtPSBwYXJzZUludChjLndpZHRoLCAxMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyBsZWZ0U2Nyb2xsLCByaWdodFNjcm9sbDogcmlnaHRTY3JvbGwgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VmVydGljYWxTY3JvbGxQb3NpdGlvbnMocm93SW5kZXg6IG51bWJlciwgdmlzaWJsZUluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0Q29sID0gdGhpcy5ncmlkLmdldENvbHVtbkJ5VmlzaWJsZUluZGV4KHZpc2libGVJbmRleCk7XG4gICAgICAgIGNvbnN0IHJvd1NwYW4gPSB0YXJnZXRDb2wucm93RW5kICYmIHRhcmdldENvbC5yb3dFbmQgLSB0YXJnZXRDb2wucm93U3RhcnQgPyB0YXJnZXRDb2wucm93RW5kIC0gdGFyZ2V0Q29sLnJvd1N0YXJ0IDogMTtcbiAgICAgICAgY29uc3QgdG9wT2Zmc2V0ID0gdGhpcy5ncmlkLmRlZmF1bHRSb3dIZWlnaHQgKiAodGFyZ2V0Q29sLnJvd1N0YXJ0IC0gMSk7XG4gICAgICAgIGNvbnN0IHJvd1RvcCA9IHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5zaXplc0NhY2hlW3Jvd0luZGV4XSArIHRvcE9mZnNldDtcbiAgICAgICAgcmV0dXJuIHsgdG9wT2Zmc2V0LCByb3dUb3AsIHJvd0JvdHRvbTogcm93VG9wICsgKHRoaXMuZ3JpZC5kZWZhdWx0Um93SGVpZ2h0ICogcm93U3BhbikgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcGVyZm9ybUhvcml6b250YWxTY3JvbGxUb0NlbGwodmlzaWJsZUNvbHVtbkluZGV4OiBudW1iZXIsIGNiPzogKCkgPT4gdm9pZCkge1xuICAgICAgICBpZiAoIXRoaXMuc2hvdWxkUGVyZm9ybUhvcml6b250YWxTY3JvbGwodmlzaWJsZUNvbHVtbkluZGV4KSkgeyByZXR1cm47IH1cbiAgICAgICAgY29uc3Qgc2Nyb2xsUG9zID0gdGhpcy5nZXRDaGlsZENvbHVtblNjcm9sbFBvc2l0aW9ucyh2aXNpYmxlQ29sdW1uSW5kZXgpO1xuICAgICAgICBjb25zdCBzdGFydFNjcm9sbCA9IHNjcm9sbFBvcy5yaWdodFNjcm9sbCAtIHRoaXMuZGlzcGxheUNvbnRhaW5lclNjcm9sbExlZnQ7XG4gICAgICAgIGNvbnN0IG5leHRTY3JvbGwgPSAhKHRoaXMuZGlzcGxheUNvbnRhaW5lclNjcm9sbExlZnQgPD0gc2Nyb2xsUG9zLmxlZnRTY3JvbGwpICYmIHRoaXMuZGlzcGxheUNvbnRhaW5lcldpZHRoID49IHN0YXJ0U2Nyb2xsID9cbiAgICAgICAgICAgIHNjcm9sbFBvcy5sZWZ0U2Nyb2xsIDogc2Nyb2xsUG9zLnJpZ2h0U2Nyb2xsIC0gdGhpcy5kaXNwbGF5Q29udGFpbmVyV2lkdGg7XG4gICAgICAgIHRoaXMuZm9yT2ZEaXIoKS5nZXRTY3JvbGwoKS5zY3JvbGxMZWZ0ID0gbmV4dFNjcm9sbDtcbiAgICAgICAgdGhpcy5ncmlkLnBhcmVudFZpcnREaXIub25DaHVua0xvYWRcbiAgICAgICAgICAgIC5waXBlKGZpcnN0KCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2IpIHsgY2IoKTsgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHBlcmZvcm1WZXJ0aWNhbFNjcm9sbFRvQ2VsbChyb3dJbmRleDogbnVtYmVyLCB2aXNpYmxlQ29sSW5kZXg6IG51bWJlciwgY2I/OiAoKSA9PiB2b2lkKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5wYXJlbnRCeUNoaWxkSW5kZXgodmlzaWJsZUNvbEluZGV4IHx8IDApPy5jaGlsZHJlbjtcbiAgICAgICAgaWYgKCFzdXBlci5pc0RhdGFSb3cocm93SW5kZXgpIHx8IChjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGggPCAyKSkge1xuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBlcmZvcm1WZXJ0aWNhbFNjcm9sbFRvQ2VsbChyb3dJbmRleCwgdmlzaWJsZUNvbEluZGV4LCBjYik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb250YWluZXJIZWlnaHQgPSB0aGlzLmdyaWQuY2FsY0hlaWdodCA/IE1hdGguY2VpbCh0aGlzLmdyaWQuY2FsY0hlaWdodCkgOiAwO1xuICAgICAgICBjb25zdCBwb3MgPSB0aGlzLmdldFZlcnRpY2FsU2Nyb2xsUG9zaXRpb25zKHJvd0luZGV4LCB2aXNpYmxlQ29sSW5kZXgpO1xuICAgICAgICBjb25zdCByb3cgPSBzdXBlci5nZXRSb3dFbGVtZW50QnlJbmRleChyb3dJbmRleCk7XG4gICAgICAgIGlmICgodGhpcy5zY3JvbGxUb3AgPiBwb3Mucm93VG9wKSAmJiAoIXJvdyB8fCByb3cub2Zmc2V0VG9wICsgcG9zLnRvcE9mZnNldCA8IE1hdGguYWJzKHRoaXMuY29udGFpbmVyVG9wT2Zmc2V0KSkpIHtcbiAgICAgICAgICAgIHBvcy50b3BPZmZzZXQgPT09IDAgPyB0aGlzLmdyaWQudmVydGljYWxTY3JvbGxDb250YWluZXIuc2Nyb2xsVG8ocm93SW5kZXgpIDpcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWQudmVydGljYWxTY3JvbGxDb250YWluZXIuc2Nyb2xsUG9zaXRpb24gPSBwb3Mucm93VG9wO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ncmlkLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyLmFkZFNjcm9sbFRvcChNYXRoLmFicyhwb3Mucm93Qm90dG9tIC0gdGhpcy5zY3JvbGxUb3AgLSBjb250YWluZXJIZWlnaHQpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdyaWQudmVydGljYWxTY3JvbGxDb250YWluZXIub25DaHVua0xvYWRcbiAgICAgICAgICAgIC5waXBlKGZpcnN0KCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNiKSB7IGNiKCk7IH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldE5leHRIb3Jpem9udGFsQ2VsbFBvc2l0aW9uKHByZXZpb3VzID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnRCeUNoaWxkSW5kZXgodGhpcy5hY3RpdmVOb2RlLmNvbHVtbik7XG4gICAgICAgIGlmICghdGhpcy5oYXNOZXh0SG9yaXpvbnRhbFBvc2l0aW9uKHByZXZpb3VzLCBwYXJlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4geyByb3c6IHRoaXMuYWN0aXZlTm9kZS5yb3csIGNvbHVtbjogdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSBwcmV2aW91cyA/IHBhcmVudC5jaGlsZHJlbi5maWx0ZXIoYyA9PiBjLnJvd1N0YXJ0IDw9IHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQucm93U3RhcnQpXG4gICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gYi52aXNpYmxlSW5kZXggLSBhLnZpc2libGVJbmRleCkgOiBwYXJlbnQuY2hpbGRyZW4uZmlsdGVyKGMgPT4gYy5yb3dTdGFydCA8PSB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LnJvd1N0YXJ0KTtcbiAgICAgICAgbGV0IGNvbHVtbiA9IGNvbHVtbnMuZmluZCgoY29sKSA9PiBwcmV2aW91cyA/XG4gICAgICAgICAgICAgICAgY29sLnZpc2libGVJbmRleCA8IHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4gJiYgdGhpcy5yb3dFbmQoY29sKSA+IHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQucm93U3RhcnQgOlxuICAgICAgICAgICAgICAgIGNvbC52aXNpYmxlSW5kZXggPiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uICYmIGNvbC5jb2xTdGFydCA+IHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQuY29sU3RhcnQpO1xuICAgICAgICBpZiAoIWNvbHVtbiB8fCAocHJldmlvdXMgJiYgdGhpcy5hY3RpdmVOb2RlLmxheW91dC5jb2xTdGFydCA9PT0gMSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcHJldmlvdXMgPyBwYXJlbnQudmlzaWJsZUluZGV4IC0gMSA6IHBhcmVudC52aXNpYmxlSW5kZXggKyAxO1xuICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmdyaWQuY29sdW1uTGlzdC5maW5kKGNvbHMgPT4gY29scy5jb2x1bW5MYXlvdXQgJiYgY29scy52aXNpYmxlSW5kZXggPT09IGluZGV4KS5jaGlsZHJlbjtcbiAgICAgICAgICAgIGNvbHVtbiA9IHByZXZpb3VzID8gY2hpbGRyZW4udG9BcnJheSgpLnJldmVyc2UoKS5maW5kKGNoaWxkID0+IGNoaWxkLnJvd1N0YXJ0IDw9IHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQucm93U3RhcnQpIDpcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5maW5kKGNoaWxkID0+IHRoaXMucm93RW5kKGNoaWxkKSA+IHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQucm93U3RhcnQgJiYgY2hpbGQuY29sU3RhcnQgPT09IDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHJvdzogdGhpcy5hY3RpdmVOb2RlLnJvdywgY29sdW1uOiBjb2x1bW4udmlzaWJsZUluZGV4IH07XG4gICAgfVxuXG4gICAgZ2V0TmV4dFZlcnRpY2FsUG9zaXRpb24ocHJldmlvdXMgPSBmYWxzZSkge1xuICAgICAgICB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uID0gdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiB8fCAwO1xuICAgICAgICBpZiAoIXRoaXMuaGFzTmV4dFZlcnRpY2FsUG9zaXRpb24ocHJldmlvdXMpKSB7XG4gICAgICAgICAgICByZXR1cm4geyByb3c6IHRoaXMuYWN0aXZlTm9kZS5yb3csIGNvbHVtbjogdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiB9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1cnJlbnRSb3dTdGFydCA9IHRoaXMuZ3JpZC5nZXRDb2x1bW5CeVZpc2libGVJbmRleCh0aGlzLmFjdGl2ZU5vZGUuY29sdW1uKS5yb3dTdGFydDtcbiAgICAgICAgY29uc3QgbmV4dEJsb2NrID0gIXRoaXMuaXNEYXRhUm93KHRoaXMuYWN0aXZlTm9kZS5yb3cpIHx8XG4gICAgICAgIChwcmV2aW91cyA/IGN1cnJlbnRSb3dTdGFydCA9PT0gMSA6IGN1cnJlbnRSb3dTdGFydCA9PT0gdGhpcy5sYXN0Um93U3RhcnRQZXJCbG9jaygpKTtcbiAgICAgICAgY29uc3QgbmV4dFJJID0gcHJldmlvdXMgPyB0aGlzLmFjdGl2ZU5vZGUucm93IC0gMSA6IHRoaXMuYWN0aXZlTm9kZS5yb3cgKyAxO1xuICAgICAgICBpZiAobmV4dEJsb2NrICYmICF0aGlzLmlzRGF0YVJvdyhuZXh0UkkpKSB7XG4gICAgICAgICAgICByZXR1cm4ge3JvdzogbmV4dFJJLCAgY29sdW1uOiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1ufTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMucGFyZW50QnlDaGlsZEluZGV4KHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4pLmNoaWxkcmVuO1xuICAgICAgICBjb25zdCBjb2wgPSBwcmV2aW91cyA/IHRoaXMuZ2V0UHJldmlvdXNSb3dJbmRleChjaGlsZHJlbiwgbmV4dEJsb2NrKSA6IHRoaXMuZ2V0TmV4dFJvd0luZGV4KGNoaWxkcmVuLCBuZXh0QmxvY2spO1xuICAgICAgICByZXR1cm4geyByb3c6IG5leHRCbG9jayA/IG5leHRSSSA6IHRoaXMuYWN0aXZlTm9kZS5yb3csIGNvbHVtbjogY29sLnZpc2libGVJbmRleCB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TmV4dFJvd0luZGV4KGNoaWxkcmVuLCBuZXh0KSB7XG4gICAgICAgIGNvbnN0IHJvd1N0YXJ0ID0gbmV4dCA/IDEgOiB0aGlzLnJvd0VuZCh0aGlzLmdyaWQuZ2V0Q29sdW1uQnlWaXNpYmxlSW5kZXgodGhpcy5hY3RpdmVOb2RlLmNvbHVtbikpO1xuICAgICAgICBjb25zdCAgY29sID0gY2hpbGRyZW4uZmlsdGVyKGMgPT4gYy5yb3dTdGFydCA9PT0gcm93U3RhcnQpO1xuICAgICAgICByZXR1cm4gY29sLmZpbmQoY28gPT4gY28uY29sU3RhcnQgPT09IHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQuY29sU3RhcnQpIHx8XG4gICAgICAgICAgICBjb2wuc29ydCgoYSwgYikgPT4gYi52aXNpYmxlSW5kZXggLSBhLnZpc2libGVJbmRleCkuZmluZChjbyA9PiBjby5jb2xTdGFydCA8PSB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LmNvbFN0YXJ0KTsgICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQcmV2aW91c1Jvd0luZGV4KGNoaWxkcmVuLCBwcmV2KSB7XG4gICAgICAgIGNvbnN0IGVuZCA9IHByZXYgPyBNYXRoLm1heCguLi5jaGlsZHJlbi5tYXAoYyA9PiB0aGlzLnJvd0VuZChjKSkpIDpcbiAgICAgICAgICAgIHRoaXMuZ3JpZC5nZXRDb2x1bW5CeVZpc2libGVJbmRleCh0aGlzLmFjdGl2ZU5vZGUuY29sdW1uKS5yb3dTdGFydDtcbiAgICAgICAgY29uc3QgY29sID0gY2hpbGRyZW4uZmlsdGVyKGMgPT4gdGhpcy5yb3dFbmQoYykgPT09ICBlbmQpO1xuICAgICAgICByZXR1cm4gY29sLmZpbmQoY28gPT4gY28uY29sU3RhcnQgPT09IHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQuY29sU3RhcnQpIHx8XG4gICAgICAgICAgICBjb2wuc29ydCgoYSwgYikgPT4gYi52aXNpYmxlSW5kZXggLSBhLnZpc2libGVJbmRleCkuZmluZChjbyA9PiBjby5jb2xTdGFydCA8PSB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LmNvbFN0YXJ0KTtcbiAgICB9XG5cbiAgICBoZWFkZXJOYXZpZ2F0aW9uKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGtleSA9IGV2ZW50LmtleS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAoIUhFQURFUl9LRVlTLmhhcyhrZXkpKSB7IHJldHVybjsgfVxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAoIXRoaXMuYWN0aXZlTm9kZS5sYXlvdXQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQgPSB0aGlzLmxheW91dCh0aGlzLmFjdGl2ZU5vZGUuY29sdW1uIHx8IDApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFsdCA9IGV2ZW50LmFsdEtleTtcbiAgICAgICAgY29uc3QgY3RybCA9IGV2ZW50LmN0cmxLZXk7XG4gICAgICAgIHRoaXMucGVyZm9ybUhlYWRlcktleUNvbWJpbmF0aW9uKHRoaXMuZ3JpZC5nZXRDb2x1bW5CeVZpc2libGVJbmRleCh0aGlzLmFjdGl2ZU5vZGUuY29sdW1uKSwga2V5LCBldmVudC5zaGlmdEtleSwgY3RybCwgYWx0LCBldmVudCk7XG4gICAgICAgIGlmICghY3RybCAmJiAhYWx0ICYmIChrZXkuaW5jbHVkZXMoJ2Rvd24nKSB8fCBrZXkuaW5jbHVkZXMoJ3VwJykpKSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMucGFyZW50QnlDaGlsZEluZGV4KHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4pLmNoaWxkcmVuO1xuICAgICAgICAgICAgY29uc3QgY29sID0ga2V5LmluY2x1ZGVzKCdkb3duJykgPyB0aGlzLmdldE5leHRSb3dJbmRleChjaGlsZHJlbiwgZmFsc2UpIDogdGhpcy5nZXRQcmV2aW91c1Jvd0luZGV4KGNoaWxkcmVuLCBmYWxzZSk7XG4gICAgICAgICAgICBpZiAoIWNvbCkgeyByZXR1cm47IH1cbiAgICAgICAgICAgIHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4gPSBjb2wudmlzaWJsZUluZGV4O1xuICAgICAgICAgICAgY29uc3QgbmV3TGF5b3V0ID0gdGhpcy5sYXlvdXQodGhpcy5hY3RpdmVOb2RlLmNvbHVtbik7XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQsIHtyb3dTdGFydDogbmV3TGF5b3V0LnJvd1N0YXJ0LCByb3dFbmQ6IG5ld0xheW91dC5yb3dFbmR9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhvcml6b250YWxOYXYoZXZlbnQsIGtleSwgLTEpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBob3Jpem9udGFsTmF2KGV2ZW50OiBLZXlib2FyZEV2ZW50LCBrZXk6IHN0cmluZywgcm93SW5kZXg6IG51bWJlcikge1xuICAgICAgICBjb25zdCBjdHJsID0gZXZlbnQuY3RybEtleTtcbiAgICAgICAgaWYgKCFIT1JJWk9OVEFMX05BVl9LRVlTLmhhcyhrZXkpIHx8IGV2ZW50LmFsdEtleSkgeyByZXR1cm47IH1cbiAgICAgICAgdGhpcy5hY3RpdmVOb2RlLnJvdyA9IHJvd0luZGV4O1xuICAgICAgICBpZiAoKGtleS5pbmNsdWRlcygnbGVmdCcpIHx8IGtleSA9PT0gJ2hvbWUnKSAmJiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uID4gMCkge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiA9IGN0cmwgfHwga2V5ID09PSAnaG9tZScgPyB0aGlzLmZpcnN0SW5kZXhQZXJSb3cgOiB0aGlzLmdldE5leHRIb3Jpem9udGFsQ2VsbFBvc2l0aW9uKHRydWUpLmNvbHVtbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKGtleS5pbmNsdWRlcygncmlnaHQnKSB8fCBrZXkgPT09ICdlbmQnKSAmJiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uICE9PSB0aGlzLmxhc3RJbmRleFBlclJvdykge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiA9IGN0cmwgfHwga2V5ID09PSAnZW5kJyA/IHRoaXMubGFzdEluZGV4UGVyUm93IDogdGhpcy5nZXROZXh0SG9yaXpvbnRhbENlbGxQb3NpdGlvbigpLmNvbHVtbjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdMYXlvdXQgPSB0aGlzLmxheW91dCh0aGlzLmFjdGl2ZU5vZGUuY29sdW1uKTtcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LCB7Y29sU3RhcnQ6IG5ld0xheW91dC5jb2xTdGFydCwgcm93RW5kOiBuZXdMYXlvdXQucm93RW5kfSk7XG4gICAgICAgIHRoaXMucGVyZm9ybUhvcml6b250YWxTY3JvbGxUb0NlbGwodGhpcy5hY3RpdmVOb2RlLmNvbHVtbik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgbGFzdEluZGV4UGVyUm93KCk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5ncmlkLnZpc2libGVDb2x1bW5zLmZpbmQoYyA9PiBjLnZpc2libGVJbmRleCA9PT0gdGhpcy5sYXN0TGF5b3V0SW5kZXggJiYgYy5jb2x1bW5MYXlvdXQpXG4gICAgICAgICAgICAuY2hpbGRyZW4udG9BcnJheSgpLnJldmVyc2UoKTtcbiAgICAgICAgY29uc3QgY29sdW1uID0gY2hpbGRyZW4uZmluZChjbyA9PiBjby5yb3dTdGFydCA9PT0gdGhpcy5hY3RpdmVOb2RlLmxheW91dC5yb3dTdGFydCkgfHxcbiAgICAgICAgY2hpbGRyZW4uZmluZChjbyA9PiBjby5yb3dTdGFydCA8PSB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LnJvd1N0YXJ0KTtcbiAgICAgICAgcmV0dXJuIGNvbHVtbi52aXNpYmxlSW5kZXg7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgZmlyc3RJbmRleFBlclJvdygpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuZ3JpZC52aXNpYmxlQ29sdW1ucy5maW5kKGMgPT4gYy52aXNpYmxlSW5kZXggPT09IDAgJiYgYy5jb2x1bW5MYXlvdXQpLmNoaWxkcmVuO1xuICAgICAgICBjb25zdCBjb2x1bW4gPSBjaGlsZHJlbi5maW5kKGNvID0+IGNvLnJvd1N0YXJ0ID09PSB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LnJvd1N0YXJ0KSB8fFxuICAgICAgICBjaGlsZHJlbi5maW5kKGNvID0+IGNvLnJvd1N0YXJ0IDw9IHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQucm93U3RhcnQpO1xuICAgICAgICByZXR1cm4gY29sdW1uLnZpc2libGVJbmRleDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldCBsYXN0TGF5b3V0SW5kZXgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLnRoaXMuZ3JpZC52aXNpYmxlQ29sdW1ucy5maWx0ZXIoYyA9PiBjLmNvbHVtbkxheW91dCkubWFwKGNvbCA9PiBjb2wudmlzaWJsZUluZGV4KSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgc2Nyb2xsVG9wKCk6IG51bWJlciB7XG4gICAgICAgcmV0dXJuIE1hdGguYWJzKHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5nZXRTY3JvbGwoKS5zY3JvbGxUb3ApO1xuICAgIH1cblxuICAgIHByaXZhdGUgbGFzdENvbEluZGV4UGVyTVJMQmxvY2sodmlzaWJsZUluZGV4ID0gdGhpcy5hY3RpdmVOb2RlLmNvbHVtbik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudEJ5Q2hpbGRJbmRleCh2aXNpYmxlSW5kZXgpLmNoaWxkcmVuLmxhc3QudmlzaWJsZUluZGV4O1xuICAgIH1cblxuICAgIHByaXZhdGUgbGFzdFJvd1N0YXJ0UGVyQmxvY2sodmlzaWJsZUluZGV4ID0gdGhpcy5hY3RpdmVOb2RlLmNvbHVtbikge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgoLi4udGhpcy5wYXJlbnRCeUNoaWxkSW5kZXgodmlzaWJsZUluZGV4KS5jaGlsZHJlbi5tYXAoYyA9PiBjLnJvd1N0YXJ0KSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByb3dFbmQoY29sdW1uKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGNvbHVtbi5yb3dFbmQgJiYgY29sdW1uLnJvd0VuZCAtIGNvbHVtbi5yb3dTdGFydCA/IGNvbHVtbi5yb3dTdGFydCArIGNvbHVtbi5yb3dFbmQgLSBjb2x1bW4ucm93U3RhcnQgOiBjb2x1bW4ucm93U3RhcnQgKyAxO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBwdWJsaWMgbGF5b3V0KHZpc2libGVJbmRleCkge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdyaWQuZ2V0Q29sdW1uQnlWaXNpYmxlSW5kZXgodmlzaWJsZUluZGV4KTtcbiAgICAgICAgcmV0dXJuIHtjb2xTdGFydDogY29sdW1uLmNvbFN0YXJ0LCByb3dTdGFydDogY29sdW1uLnJvd1N0YXJ0LFxuICAgICAgICAgICAgICAgIGNvbEVuZDogY29sdW1uLmNvbEVuZCwgcm93RW5kOiBjb2x1bW4ucm93RW5kLCBjb2x1bW5WaXNpYmxlSW5kZXg6IGNvbHVtbi52aXNpYmxlSW5kZXggfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBhcmVudEJ5Q2hpbGRJbmRleCh2aXNpYmxlSW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZC5nZXRDb2x1bW5CeVZpc2libGVJbmRleCh2aXNpYmxlSW5kZXgpPy5wYXJlbnQ7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhc05leHRIb3Jpem9udGFsUG9zaXRpb24ocHJldmlvdXMgPSBmYWxzZSwgcGFyZW50KSB7XG4gICAgICAgIGlmIChwcmV2aW91cyAmJiBwYXJlbnQudmlzaWJsZUluZGV4ID09PSAwICYmIHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQuY29sU3RhcnQgPT09IDEgfHxcbiAgICAgICAgICAgICFwcmV2aW91cyAmJiBwYXJlbnQudmlzaWJsZUluZGV4ID09PSB0aGlzLmxhc3RMYXlvdXRJbmRleCAmJiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uID09PSB0aGlzLmxhc3RJbmRleFBlclJvdykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFzTmV4dFZlcnRpY2FsUG9zaXRpb24ocHJldiA9IGZhbHNlKSB7XG4gICAgICAgIGlmICgocHJldiAmJiB0aGlzLmFjdGl2ZU5vZGUucm93ID09PSAwICYmICghdGhpcy5pc0RhdGFSb3codGhpcy5hY3RpdmVOb2RlLnJvdykgfHwgdGhpcy5hY3RpdmVOb2RlLmxheW91dC5yb3dTdGFydCA9PT0gMSkpIHx8XG4gICAgICAgICAgICAoIXByZXYgJiYgdGhpcy5hY3RpdmVOb2RlLnJvdyA+PSB0aGlzLmdyaWQuZGF0YVZpZXcubGVuZ3RoIC0gMSAmJiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uID09PSB0aGlzLmxhc3RDb2xJbmRleFBlck1STEJsb2NrKCkpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuIl19